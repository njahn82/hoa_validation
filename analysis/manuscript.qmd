---
format:
  pdf:
    keep-tex: true
    fig_caption: yes
    template: apa6.sty
    extra_dependencies: ["flafter"]
csl: apa.csl
bibliography: references.bib
---


```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 6,
  fig.asp = 0.618,
  out.width = "99%",
  fig.align = "center",
  dpi = 600,
  dev = c("pdf", "cairo_ps", "png"),
  fig.path = "fig/",
  fig.pos = "ht!", out.extra = ""
)
options(scipen = 999, digits = 2)
knitr::knit_hooks$set(
  inline = function(x) {
    if (is.numeric(x)) {
      return(prettyNum(x, big.mark = ","))
    } else{
      return(x)
    }
  }
)
```

```{r dependencies}
library(tidyverse, warn.conflicts = FALSE)
library(bigrquery)
library(kableExtra)
library(patchwork)
library(ComplexUpset)

# Themes
my_upset_theme <-
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank(),
        plot.title.position="plot",
        text = element_text(size = 10),
        plot.title = element_text(hjust = 0, vjust = 1))
```

# Introduction

This study aims to demonstrate the suitability of open scholarly data sources for assessing the impact of transformative agreements on hybrid open access.
To achieve this, a replication study was conducted by comparing results from hoaddata, an openly available and continuously updated dataset on hybrid open access uptake based on Crossref, OpenAlex, and the cOAlition S Journal Checker Tool, with the established bibliometric databases Web of Science and Scopus.

This study focuses on the coverage of hybrid journal portfolios included in transformative agreements between 2019 and 2023.
Special attention is given to potential differences in open access uptake by country when comparing first-author affiliation data to corresponding authorships.
This is crucial because the lack of publicly available invoicing data corresponding to authorships plays an essential role in determining whether an open-access article is supported through transformative agreements.
Data on corresponding authorships have been available on the Web of Science and Scopus for much longer than in open databases such as OpenAlex, where this information is still being roled out at the time of writing.
Because of this weakness, open approaches such as hoaddata and related research use first-authorship data instead.

By conducting a large-scale comparative analysis, this study aims to

1. Determine the strengths and weaknesses of using open data sources in monitoring the impact of transformative agreements on hybrid open access publishing.
2. Assess the coverage and accuracy of open data sources compared with established bibliometric databases.
3. Evaluate the reliability of first author affiliation data as a proxy for corresponding authorship in the context of open access uptake analysis.  

# Background -- Evidence base to measure the effects of transformative agreements  

## Anforderungen an das Monitoring  

- esac guidelines 
- gemeinsamkeiten und unterschiede zu apc (listenpreise, tatsächliche zahlungen, zentrales invoicing, rabatte, waivers) 
- insitutionen covern cas, jedoch kann es zu unterschiedlichen verrechnugnsformen führen (antielig mit förderer, splitting innerhaklbd er einrichtung)  

## Bibliometrische Evidenzen  

- allgmeeiner uptake 
- wachstum apcs 
- wachstum verträge (konsortien, forschung) 
- konsequenzen  

# Data and methods

This study investigates the suitability of open scholarly data sources for assessing the impact of transformative agreements on hybrid open access.
As shown in Figure \ref{fig:workflow}, the methodology involved comparing hoaddata, an openly available collection of open research information on hybrid open access, with the bibliometric databases Web of Science and Scopus.
This section introduces the initial data sources, followed by a presentation of the necessary data processing steps to obtain eligible articles from transformative agreements by using author roles (first and corresponding) and harmonised affiliation data.
<!-- Overall, xxxx hybrid journals from xxx agreements that published at least one open access article between 2019 and 2023. formed the basis of this study. -->

<!-- Replication studies, which can be found in the Life, Natural and Social Sciences, typically employ the same or comparable methods as the original study to determine whether consistent results can be obtained (https://pmc.ncbi.nlm.nih.gov/articles/PMC10019630/). 


This study compares results drawn from the openly available and regularly updated hoaddata, an R package leveraging the open scholarly data sources Crossref and OpenAlex, with the in-house database of the German Competence Network for Bibliometrics (Kompetenznetzwerk Bibliometrie, KB), which comprises Web of Science and Scopus snapshots.
After describing the initial data sources used, the necessary pre-processing steps to obtain eligible articles from transformative agreements using author roles (first and corresponding) and affiliation data are presented.
Overall, xxxx hybrid journals from xxx agreements formed the basis of this study. This study covered journal articles published between 2019 and 2023.   -->

\begin{figure}[htbp]
\centering
\begin{tikzpicture}[node distance=2cm, thick,scale=1, every node/.style={scale=0.9}]    
% Data Sources
    \node (crossref) [datasource] {Crossref};
    \node (openAlex) [datasource, right=of crossref] {OpenAlex};
    \node (jct) [datasource, right=of openAlex] {JCT};
    \node (wos) [datasource, below=of crossref] {Web of Science};
    \node (scopus) [datasource, below=of jct] {Scopus};
    
    % Processing Steps
    \node (hoaddata) [datasource, below=1.5cm of $(crossref)!1!(openAlex)$] {hoaddata};
    \node (kb) [process, below=1cm of $(wos)!0.5!(scopus)$] {Journal and article retrieval (including open access)};
    
 % Matching Process - Fixed line break syntax
    \node (matching) [process, below=1.5cm of $(hoaddata)!1!(kb)$] {Harmonising author affiliations through RoR};

 % Aggregation
    \node (transmatch) [process, below=1.5cm of $(matching)!1!(matching)$] {Estimate TA output};
        
    % Output
    \node (analysis) [output, below=1.5cm of $(transmatch)!1!(transmatch)$] {Aggregated analytical datasets};
    
    % Arrows
    \draw [arrow] (crossref) -- (hoaddata);
    \draw [arrow] (openAlex) -- (hoaddata);
    \draw [arrow] (jct) -- (hoaddata);
    \draw [arrow] (hoaddata) -- (kb);
    \draw [arrow] (wos) -- (kb);
    \draw [arrow] (scopus) -- (kb);
    \draw [arrow] (kb) -- (matching);
    \draw [arrow] (matching) -- (transmatch);
    \draw [arrow] (transmatch) -- (analysis);

    
    % Legend
    \node [datasource, scale=0.7] at ($(analysis)+(4,0)$) {Data Sources};
    \node [process, scale=0.7] at ($(analysis)+(4,-1)$) {Processing Steps};
    \node [output, scale=0.7] at ($(analysis)+(4,-2)$) {Output};
\end{tikzpicture}
\caption{Data processing workflow for comparing hybrid open access uptake across bibliometric data sources. The workflow shows how data from different sources (Crossref, OpenAlex, JCT, Web of Science, and Scopus) is processed and matched using ROR identifiers to enable comparative analysis. TA = Transformative Agreement}
\label{fig:workflow}
\end{figure}

## Data sources  

### hoaddata 

hoaddata, developed and maintained by the author to support open access monitoring and research [@Jahn_2025], is an R data package collecting information on hybrid open access uptake from multiple openly available data sources.
It combines article-level metadata from Crossref and OpenAlex with transformative agreement information from the cOAlition S Journal Checker Tool (JCT), which links journal and institutional data to agreements in the ESAC registry.

As discussed elsewhere [@Jahn_2025], hoaddata uses a unified dataset of historic JCT snapshots, which were safeguarded since July 2021.
Journal data were enriched with ISSN variants linked to an ISSN-L and insitution data with associated ROR-IDs representing university hospitals or institutes of large research organisations, according to OpenAlex' institution entity.
A comprehensive exclusion of fully open access journals using multiple journal lists (DOAJ, OpenAlex, Bielefeld)  was performed to identify hybrid journals.
hoaddata relies on Crossref for obtaining journal publication volume and open access status through Creative Commons licence information relative to the published version ("version of record").
Because of limited affiliation metadata in Crossref [@van_Eck_2022], hoaddata sources  affiliation metadata from OpenAlex.

<!--While the country in which a first-author was located was used to aggregate country-level statistics, Research Organization Registry (ROR) identifiers (ROR-ID) were used in conjunction with ESAC registry information on the duration of an agreement was used to estimate whether an article was published under active transformative agreements.
This matching benefited from the availability of the ROR-IDs in both sources.
To improve the matching, JCT data were enriched to include associated institutions, such as unviersity hospitals.-->

hoaddata follows good practices for computational reproducibility using R [@Marwick_2018].
The package, which includes data, code, a test suite and documentation, is openly available on GitHub.
To ensure computational reproducibility while aggregating the data, a GitHub Actions continuous integration and delivery (CI/CD) workflow handles data retrieval from the SUB Göttingen's open scholarly data warehouse based on Google BigQuery, which provides high-performant programmatic access to monthly snapshots of Crossref and OpenAlex.
The workflow has run regularly to fetch updates from these data sources since 2022.
The package version used in this study is 0.3, containing data from the Crossref 2024-08 dump provided to Crossref Metadata Plus subscribers and the OpenAlex 2024-08-29 monthly dump.
This version including the computation log is available on GitHub (https://github.com/subugoe/hoaddata/releases/tag/v.0.3).

### Web of Science

Clarivate Analytics' Web of Science (WoS) is a well-established proprietary bibliometric database consisting of several collections [@Birkle_2020]. 
The collections considered in this study were the Science Citation Index Expanded (SCIE), the Social Sciences Citation Index (SSCI) and the Arts & Humanities Citation Index (AHCI), collectively referred to as Web of Science Primary (WoS Primary).

The WoS Primary provides important data points for analysing open access: author affiliations and roles, differentiation of journal articles into document types representing different types of journal contributions, such as original articles or reviews, and open access status information derived from OurResearch's Unpaywall, the same provider as OpenAlex.
However, it lacks information about journals and articles under transformative agreements.

For programmatic access to article-level data, this study used the database of the Kompetenznetzwerk Bibliometrie (KB) in Germany. The KB processes raw XML data provided by Clarivate Analytics, which is provided as an in-house PostgreSQL database under a uniform schema.
To support reproducibility, KB maintains annual snapshots of the database. 
Accordingly, this study used the annual snapshot from April 2024 (wos_b_202404), which is considered to cover almost the entire previous publication year [@schmidt_2024_13935407].

### Scopus

Elsevier's Scopus, launched in 2004, is another widely used proprietary bibliometric database for measuring research [@Baas_2020].
Similar to the Web of Science, Scopus is selective with regard to the journals it indexes.
However, its coverage is substantially more extensive than that of the Web of Science collections considered in this study [@Singh_2021; @Visser_2021].
With detailed metadata about article types, open access status information derived from Unpaywall, author roles, and disambiguated affiliations, Scopus also contains important data to assess open access uptake, although no direct information regarding transformative agreements was available at the time of the study.

This study used the Scopus annual snapshot of April 2024 as provided by the KB (scp_b_202404). The same KB curation effort was applied to the  Scopus raw data as for the Web of Science [@schmidt_2024_13935407].

## Data processing steps  

### Determining hybrid journal publication volume

The hoaddata package (v.0.3) provided an enriched and unified list of hybrid journals in transformative agreements according to the JCT, covering agreements active from July 2021 to July 2024 according to the ESAC registry.
<!-- This study examined the adoption of open access for hybrid journals included in transformative agreements, which published at least one journal article in the five-year period 2019-2023. 
The initial data source was the Transformative Agreements Public Data from the cOAlition S Journal Checker Tool (JCT), which helps authors identify suitable open access publishing venues, as provided by hoaddata.
 Weekly snapshots of this data were archived using an automated GitHub Actions workflow (https://github.com/njahn82/jct_data) and into hoaddata.
The JCT data used in the examined hoaddata version, which was enriched with linking ISSN (ISSN-L) and ROR-IDs from associated institutions before inclusion, cover agreements active from July 2021 to July 2024. -->

<!-- The JCT journal data was enriched with the linking ISSN (ISSN-L) according to the ISSN Registry Agency.
A comprehensive exclusion of fully open access journals was performed, following the methodology described in @jahn_2025.
This involved checking multiple journal lists (DOAJ, OpenAlex, Bielefeld) and article-level investigations.
The JCT institution data was enriched with ROR-IDs from associated institutions, such as university hospitals or institutes of large research organisations such as the Max Planck Society, according to OpenAlex' institution entity.
<!-- In total, xxxx hybrid journals could be linked to xxx agreements listed in the ESAC Transformative Agreements Registry, which formed to basis for obtaining article-level data including author affiliations, open access status ans document types. -->
Article metadata were retrieved from each database using all ISSN variants linked to an ISSN-L. The metadata included DOIs, publication dates, article types, open access information as well as author roles and institutional affiliations.
Publication years were determined using the earliest known date of publication in a journal.
In hoaddata, this corresponded to Crossref's issued date.<!--, although variations were observed (check ref)-->
For Web of Science and Scopus, the earliest publication date was used where available, with Scopus dates specifically determined by the KB through version tracking of the raw data.

Many transformative agreements typically cover only certain types of journal
articles, in particular original research articles including reviews.
Because of limited information on these document types in open scholarly data [@Haupka_2024], hoaddata used an extended version of Unpaywall's paratext recognition approach to exclude non-scholarly content [@Piwowar_2018].
To exclude conference supplements, which are also often not covered by transformative agreements, only articles published in regular issues, indicated by numerical pagination, were considered.
For Web of Science and Scopus, their established document type classifications were used to identify original research articles and reviews, referred to as core articles throughout this study.

<!-- literature to check https://direct.mit.edu/qss/article/3/1/99/109079/The-prevalence-and-impact-of-university-->

### Identifying open access articles in hybrid journals

Published articles were considered hybrid open access  when they were made freely available under a Creative Commons license on publishers' platforms. 
While hoaddata sourced this information from Crossref license metadata, Web of Science and Scopus relied on Unpaywall. 
Unpaywall supplements Crossref metadata by parsing publisher websites directly, addressing cases where publishers do not provide machine-readable Creative Commons license information [@Piwowar_2018]. 
This additional parsing remains necessary despite transformative agreement workflows recommend the depositing license information during DOI registration [@Geschuhn_2017].
Both Web of Science and Scopus defined hybrid open access consistently as content available under Creative Commons licenses on publisher platforms, distinguishing it from bronze open access that lack such explicit license information.

### Harmonising author affiliations across databases

```{r cache=TRUE}
# Article level data TA
ta_oa_inst <- readr::read_csv(here::here("data-raw", "ta_oa_inst.csv"))
```
Author affiliations were retrieved for both first and, if available, corresponding authors across all databases to prepare the linking between articles and institutions covered by transformative agreements.
To handle different address variants, database-specific affiliation identifiers were used: ROR-IDs from OpenAlex for hoaddata, affiliation enhanced names for Web of Science, and Scopus Affiliation Identifiers for Scopus.
Additionally, ISO country codes were retrieved for each author's address to compile country-level statistics. 
These country codes for Web of Science and Scopus were provided by the KB.

Because neither Web of Science nor Scopus support ROR IDs—the institution identifier used by the JCT—a two-step matching process was implemented to harmonise affiliation data.
First, `r length(unique(ta_oa_inst$doi))` articles from `r length(unique(ta_oa_inst$ror))` institutions with ROR-IDs in the JCT data since 2017 (according to hoaddata) were processed to map first authors' ROR-IDs to corresponding proprietary affiliation identifier in Web of Science and Scopus using DOI matching.
Then, an algorithm selected the most frequent ROR ID and proprietary identifier pairs to handle multiple affiliations and organisational hierarchy differences.

```{r aff_evaluation}
scp_ror <- readr::read_csv(here::here("data-raw", "scp_wos_matching.csv")) 
wos_ror <- readr::read_csv(here::here("data-raw", "ror_wos_matching.csv")) 
```

This process linked `r length(unique(scp_ror$ror))` ROR IDs to  `r length(unique(scp_ror$vendor_org_id))` Scopus Affiliation IDs, and  `r length(unique(wos_ror$ror))` ROR IDs to `r length(unique(wos_ror$vendor_org_id))` enhanced affiliation strings in the Web of Science. 
Quality evaluation through random sampling of 50 pairs revealed an error rate of 22% for Web of Science (11 mismatches) and 6% for Scopus (3 mismatches). 
Upon inspection, these mismatches primarily occurred with less-represented institutions having only a few publications, introduced through multiple affiliations of single authors. 
The difference between databases suggests that Scopus's affiliation control aligns more closely with ROR than that of the Web of Science.

### Estimating open access in hybrid journals covered by transformative agreements

Based on these matching tables, articles eligible under transformative agreements could also be retrieved from Web of Science and Scopus, although they did not contain the ROR IDs used by the JCT. 
The estimation of eligible articles followed @Jahn_2025 and included a matching of both journals and participating institutions according to the Transformative Agreement Data dump for each of the data sources examined.
The matching also took into account the duration of agreements according to the ESAC registry, with only those matches where an agreement was actually in place being considered for subsequent analysis.

## Data records 

As a result of the comprehensive data processing described above, datasets on open access in hybrid journals included in transformative agreements were aggregated for each database at country and journal level by year.
@tbl-methods_overview_tab provides a general overview of the coverage between 2019 and 2023 per database.
It shows that the majority of hybrid journals published at least one original research article or review marked as core during the five-year period.
These journals formed the basis for the subsequent calculation of article-level indicators.  

```{r methods_overview_tab}
#| label: tbl-methods_overview_tab
#| tbl-cap: "Coverage of hybrid journals in transformative agreements 2019-23."
load(here::here("data", "manuscript_data.Rda"))
methods_overview_table_df <- bind_rows(
  # Journals
  jns_ind,
  # Articles
  articles_ind,
  # OA
  oa_articles_ind,
  # Affiliation and Auhtor roles
  aff_ind
) |>
  # Human-readable indicator labels
  mutate(
    indicator = case_when(
      indicator == "ind_active_jns" ~ "Active journals",
      indicator == "ind_active_jns_core" ~ "Active journals (core)",
      indicator == "ind_active_jns_core_with_oa" ~ "Active journals (core) with OA",
      indicator == "ind_articles_total" ~ "Total published articles ",
      indicator == "ind_articles_core" ~ "Core articles",
      indicator == "ind_articles_doi" ~ "Articles with DOI",
      indicator == "ind_articles_core_doi" ~ "Core articles with DOI",
      indicator == "ind_oa_articles_all" ~ "OA articles",
      indicator == "ind_oa_articles_core" ~ "Core OA articles",
      indicator == "first_aff" ~ "First author articles",
      indicator == "cor_aff" ~ "Corresponding author articles",
    )
  )

kableExtra::kbl(
  methods_overview_table_df,
  booktabs = TRUE, 
  format.args = list(big.mark = ","), 
  digits = 1, 
  escape = TRUE, 
  position = "H",
  col.names = c("", "HOAD", "Web of Science", "Scopus")
) |>
  kable_styling(position = "center") |>
  row_spec(0, bold = TRUE) |>
  pack_rows("Hybrid journal coverage", 1, 3) |>
  pack_rows("Publication volume", 4, 5) |>
  pack_rows("Digital Object Identifier (DOI) coverage", 6, 7) |>
  pack_rows("Open Access (OA) metrics", 8, 9) |>
  pack_rows("Core articles with affiliation data", 10, 11) 
```

While hoaddata only covers articles with a DOI, Scopus and Web of Science publication indicators were calculated using their database identifier.
A subsequent comparison of DOI coverage shows that non-core articles in Web of Science often lacked a DOI.
This was particularly the case for meeting abstracts, which are notably prevalent in Health Sciences journals [@Melero_Fuentes_2025] and are not indexed by Scopus [@Donner_2017].
Open access indicators were aggregated by DOI, as Unpaywall only collects information on open access status for articles with a DOI.
A closer look at the core articles with affiliation data reveals a lack of data on corresponding authors in the case of OpenAlex, the affiliation data source used by hoaddata, compared to Web of Science and Scopus.
Only about two-thirds of the articles examined provided corresponding author affiliations.
For first authors, the proportion was `r methods_overview_table_df |> filter(indicator == "First author articles") |> pull(hoad) / methods_overview_table_df |> filter(indicator == "Core articles with DOI") |> pull(hoad) * 100`%.
Therefore, only first author data for hoaddata were considered in the following analysis. 

# Results  

First, I will present a coverage analysis. 
Then, I investigate hybrid open access uptake using the same methods for each database and the compare results against each other in order to assess the suitablility of the biblioemtric databases to examine transofrmative agreements. 

## Coverage comparision

### Overview

```{r}
jn_upset_articles <- readr::read_csv(here::here("data", "jn_upset_articles.csv"))

all_jns <- jn_upset_articles |> 
  distinct(issn_l)

union_jns <- jn_upset_articles |>
  filter(WoS == TRUE, Crossref == TRUE, Scopus == TRUE) |>
  distinct(issn_l)

upset_data <- jn_upset_articles |> 
   mutate(overlap = case_when(Crossref == TRUE & WoS == TRUE & Scopus == TRUE ~ doi_in_wos_or_scopus,
                             Crossref == TRUE & WoS == FALSE & Scopus == TRUE ~ doi_in_scopus,
                             Crossref == TRUE & WoS == TRUE & Scopus == FALSE ~ doi_in_wos,
                             Crossref == TRUE & WoS == FALSE & Scopus == FALSE ~ n_cr,
                             Crossref == FALSE & WoS == FALSE & Scopus == TRUE ~ doi_in_scopus,
                             Crossref == FALSE & WoS == TRUE & Scopus == FALSE ~ doi_in_wos,
                             Crossref == FALSE & WoS == TRUE & Scopus == TRUE ~ doi_in_wos_or_scopus))


```

Figure \ref{fig-upset_coverage_results} presents the coverage of hybrid journals included in transformative agreements, visualising the intersections of journals and articles across the examined databases as an UpSet graph [@Lex_2014; @ComplexUpset].
The analysis included hybrid journals that published at least one open access article between 2019 and 2023, based on open access status information from each database.
Only original research articles and reviews were considered in the analysis.

```{r upset_coverage_results, fig.asp=0.75}
#| fig-cap: "Upset graph"
#| label: fig-upset_coverage_results
# Helper function to make text labels the same size as axis labels as seen in
# <https://wjschne.github.io/posts/making-text-labels-the-same-size-as-axis-labels-in-ggplot2/>
# Todo: Learn how to invoke it

ggtext_size <- function(base_size, ratio = 0.8) {
  ratio * base_size / ggplot2::.pt
}

bar_width <- 0.7
size <- get_size_mode("exclusive_intersection")

upset_overview <- ComplexUpset::upset(
  upset_data,
  c("Crossref", "WoS", "Scopus"),
  # Only journals in Crossref
  min_size = 30,
  set_sizes = FALSE,
  stripes = "transparent",
  # wrap = TRUE,
  name = "Data Source Coverage",
  base_annotations = list(
    "Journals" = (
      ComplexUpset::intersection_size(
        counts = FALSE,
        text = list(size = 8 / .pt),
        text_mapping = aes(
          label = paste0(!!upset_text_percentage(), '\n(', format(!!size, big.mark = ","), ')'),
          colour = ifelse(!!size > 5000, 'on_bar', 'on_background'),
          y = ifelse(!!size > 5000, !!size - 4000, !!size)
        ), width = bar_width
      ) +
        scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
        ggtitle("A")
    )
  ),
  annotations = list(
    "Journal size\n(log scale)" = (
      ggplot(mapping = aes(x = intersection, y = overlap)) +
        geom_boxplot(outliers = FALSE, width = bar_width) +
        scale_y_log10(labels =  scales::number_format(big.mark = ","), limits = c(5, 10000)) +
        ggtitle("C")
    ),
    "Articles" = (
      ggplot(mapping = aes(y = n_cr)) +
        geom_bar(
          stat = "identity",
          color = "grey80",
          width = bar_width,
          aes(fill = "Surplus")
        ) +
        geom_bar(
          aes(y = overlap, fill = "Shared"),
          stat = "identity",
          width = bar_width,
          color = "#0091c8"
        ) +
        scale_fill_manual(
          values = c(
            `Surplus` = "grey80",
            `Shared` = "#0091c8"
          ),
          name = "DOI"
        ) +
        scale_y_continuous(labels =  scales::number_format(big.mark = ","),
                           breaks = c(0, 2500000, 5000000, 7500000)) +
        guides(fill = guide_legend(reverse = TRUE)) +
        ggtitle("B")
    )
  ),
  matrix = (intersection_matrix(geom = geom_point(
    shape = "square", size = 2
  )))
)
upset_overview & my_upset_theme
```
Journal coverage analysis revealed that `r round(nrow(union_jns) / nrow(all_jns) * 100)`% (n = `r nrow(union_jns)`) of hybrid journals included in transformative agreements were indexed in all three databases (Figure \ref{fig-upset_coverage_results}A).
The second-largest set consisted of journals indexed in both hoaddata and Scopus, comprising `r round( jn_upset_articles |> filter(WoS == FALSE, Crossref == TRUE, Scopus == TRUE) |> distinct(issn_l) |> nrow() / nrow(all_jns) * 100)`% (n = `r jn_upset_articles |> filter(WoS == FALSE, Crossref == TRUE, Scopus == TRUE) |>  nrow()`) of hybrid journals.
Notably, `r round(jn_upset_articles |> filter(WoS == FALSE, Crossref == TRUE, Scopus == FALSE) |> distinct(issn_l) |> nrow() / nrow(all_jns) * 100)`% (n = `r jn_upset_articles |> filter(WoS == FALSE, Crossref == TRUE, Scopus == FALSE) |>  nrow()`) of journals were exclusively contained in hoaadata, while `r round( jn_upset_articles |> filter(Crossref == FALSE, Scopus == TRUE) |> distinct(issn_l) |> nrow() / nrow(all_jns) * 100)`% (n = `r jn_upset_articles |> filter(Crossref == FALSE, Scopus == TRUE) |>  nrow()`) were only found in the proprietory database Scopus. 
Of these, `r jn_upset_articles |> filter(WoS == TRUE, Crossref == FALSE, Scopus == TRUE) |>  nrow()` were also available in the Web of Science.
Upon inspection, this group of hybrid journals included only in the proprietary data sources mainly represents hybrid journals for which no open access evidence could be retrieved from Crossref, which served as the open access evidence source for hoaddata.

In terms of article coverage, Figure \ref{fig-upset_coverage_results}B shows the total publication volume per combination in terms of DOI availability.
The largest set of hybrid journals, which includes all three data sources, also contains the largest number of articles. 
In total, these journals recorded `r upset_data |> filter(Crossref == TRUE, WoS == TRUE, Scopus == TRUE) |> pull(overlap) |> sum()` overlapping articles, represented by the blue bar. They represent `r round(upset_data |> filter(Crossref == TRUE, WoS == TRUE, Scopus == TRUE) |> pull(overlap) |> sum() / methods_overview_table_df |> filter(indicator == "Core articles with DOI") |> pull(wos) * 100)`% of core articles with DOI indexed in the Web of Science sample, and `r round(upset_data |> filter(Crossref == TRUE, WoS == TRUE, Scopus == TRUE) |> pull(overlap) |> sum() / methods_overview_table_df |> filter(indicator == "Core articles with DOI") |> pull(scp) * 100)`% in Scopus.
Another `r upset_data |> filter(Crossref == TRUE, WoS == FALSE, Scopus == TRUE) |> pull(n_cr) |> sum()` articles were exclusive to both Scopus and hoaddata. Exclusively in hoaddata were `r upset_data |> filter(Crossref == TRUE, WoS == FALSE, Scopus == FALSE) |> pull(n_cr) |> sum()` articles, and exclusively in the proprietary databases were `r upset_data |> filter(Crossref == FALSE, Scopus == TRUE) |> pull(overlap) |> sum(na.rm = TRUE)` articles. 

```{r miss_dois_check}
miss_dois <- readr::read_csv(here::here("data-raw", "missing_dois_in_active_jns.csv"))
miss_dois_val <- readr::read_csv(here::here("data-raw", "miss_dois_in_active_jns_ckeck.csv"))
```

Figure \ref{fig-upset_coverage_results}B also shows DOIs that were only available via hoaddata (grey area).
In case of hybrid journals covered by all three data sources, `r miss_dois |> nrow()` DOIs were only present in hoaddata.
After validation at the DOI level using the KB databases and manual inspection, the main reasons for missing DOI coverage in the proprietary database were insufficient classification of journal content as original research articles and reviews during the compilation of hoaddata. 
Particulalry, letters and editorials could not be fully detected.
Paratext recognition failed in `r round(miss_dois_val |> filter(is.na(scp_item_type), is.na(wos_item_type)) |> pull(n_doi) / miss_dois |> nrow() * 100)`% of DOIs to identify non-scientific content such as front matters or reviewer lists, which are generally not indexed by Scopus and Web of Science. 
To a lesser extent, differences in publication and indexing dates were a reason for non-overlapping DOIs. 

Using overlapping DOIs, the publication volume between 2019 and 2023 was also calculated for each journal. 
Figure \ref{fig-upset_coverage_results}C illustrates the distribution for each combination. It shows that there is a large spread across the journals covered by all three data sources. 
Furthermore, journals in this set published more on average than journals covered by only one or two data sources. 
In particular, the journals covered exclusively by hoaddata are substantially smaller than those covered by all three sources. 
Upon inspection, these are often newly launched journals, which explains the relatively low five-year publication volume.

### Coverage by publisher portfolio

```{r publisher_coverage_data_prep}
# Add ESAC portfolio names
esac <- hoaddata::jct_hybrid_jns |>
  distinct(issn_l, esac_publisher) |>
  mutate(
    publisher = case_when(
      esac_publisher == "Elsevier" ~ "Elsevier",
      esac_publisher == "Springer Nature" ~ "Springer Nature",
      esac_publisher == "Wiley" ~ "Wiley",
      is.character(esac_publisher) ~ "Other"
    )) |>
  mutate(publisher =
           forcats::fct_relevel(
             publisher,
             c("Elsevier", "Springer Nature", "Wiley", "Other") 
           )) |>
  mutate(publisher = forcats::fct_rev(publisher)) |>
  distinct(issn_l, publisher, esac_publisher)

jn_upset_publisher <- inner_join(upset_data, esac, by = "issn_l") |>
  # Because of Journal transfer, restrict choice to one portfolio
  distinct(issn_l, .keep_all = TRUE)

jn_upset_publisher_ind <- 
  jn_upset_publisher |>
  filter(Crossref == TRUE, Scopus == TRUE, WoS == TRUE) |> 
  group_by(publisher) |>
  summarise(n_journals = n_distinct(issn_l), articles = sum(overlap, na.rm = TRUE))

jn_upset_publisher_all <- 
  jn_upset_publisher |>
  group_by(publisher) |>
  summarise(n_journals = n_distinct(issn_l), articles = sum(overlap, na.rm = TRUE))

jn_upset_publisher_all <- jn_upset_publisher |>
  summarise(n_journals_all = n_distinct(issn_l), articles_all = sum(overlap, na.rm = TRUE)) |>
  bind_cols(jn_upset_publisher_all) |>
  mutate(prop_jn = n_journals / n_journals_all,
         prop_art = articles / articles_all)
```

Figure \ref{fig-upset_coverage_results_publisher} presents the coverage of hybrid journals in transformative agreements across data sources from 2019 to 2023 with a focus on publisher portfolios.
The analysis highlights the dominance of the three largest publishers--Elsevier, Springer Nature, and Wiley--, which collectively accounted for `r 100 - jn_upset_publisher_all |> filter(publisher == "Other") |> pull(prop_jn)*100`% of hybrid journals and `r 100 - jn_upset_publisher_all |> filter(publisher == "Other") |> pull(prop_art)*100`% of articles published during this five-year period.
In terms of article volume, Elsevier led with `r jn_upset_publisher_all |> filter(publisher == "Elsevier") |> pull(articles)` artricles (`r jn_upset_publisher_all |> filter(publisher == "Elsevier") |> pull(prop_art)*100`% of the total) published across `r jn_upset_publisher_all |> filter(publisher == "Elsevier") |> pull(n_journals)` hybrid journals(`r jn_upset_publisher_all |> filter(publisher == "Elsevier") |> pull(prop_jn)*100`% of the total). 
Springer Nature followed with `r jn_upset_publisher_all |> filter(publisher == "Springer Nature") |> pull(articles)` articles (`r jn_upset_publisher_all |> filter(publisher == "Springer Nature") |> pull(prop_art)*100`%) in `r jn_upset_publisher_all |> filter(publisher == "Springer Nature") |> pull(n_journals)` hybrid journals (`r jn_upset_publisher_all |> filter(publisher == "Springer Nature") |> pull(prop_jn)*100`%), while Wiley recorded `r jn_upset_publisher_all |> filter(publisher == "Wiley") |> pull(articles)` articles (`r jn_upset_publisher_all |> filter(publisher == "Wiley") |> pull(prop_art)*100`%) in`r jn_upset_publisher_all |> filter(publisher == "Wiley") |> pull(n_journals)` hybrid journals (`r jn_upset_publisher_all |> filter(publisher == "Wiley") |> pull(prop_jn)*100`%).
The remaining `r jn_upset_publisher |> filter(publisher == "Other") |> distinct(esac_publisher) |> nrow()` publishers collectively accounted for `r jn_upset_publisher_all |> filter(publisher == "Other") |> pull(articles)` articles (`r jn_upset_publisher_all |> filter(publisher == "Other") |> pull(prop_art)*100`%) in `r jn_upset_publisher_all |> filter(publisher == "Other") |> pull(n_journals)` hybrid journals (`r jn_upset_publisher_all |> filter(publisher == "Other") |> pull(prop_jn)*100`%).


```{r upset_publisher_plot, fig.asp=0.75}
#| fig-cap: "Upset graph publisher"
#| label: fig-upset_coverage_results_publisher
#| 
size = get_size_mode('exclusive_intersection')

upset_publisher_plot <- ComplexUpset::upset(
  jn_upset_publisher,
  c("Crossref", "WoS", "Scopus"),
  # Only journals in Crossref
  min_size = 30,
  width_ratio = 0.4,
  stripes = "transparent",
  name = "Data Source Coverage",
  base_annotations = NULL,
  annotations = list(
    "Journal size\n(log-scale)" = (
      ggplot(mapping = aes(x = intersection, y = overlap, fill = fct_rev(publisher))) +
        geom_boxplot(outliers = FALSE, width = bar_width) +
        scale_fill_manual(
          "",
          values = c(
            "Elsevier" = "#e9711c",
            "Springer Nature" = "#486a7e",
            "Wiley" = "#068853",
            "Other" = "#b3b3b3"
          ), guide = "none") +
          scale_y_log10(labels =  scales::number_format(big.mark = ",")) +
        ggtitle("C")
    ),
    "Articles" = (
      ggplot(mapping = aes(y = overlap, fill = publisher, color = publisher)) +
        geom_bar(stat = "identity", width = bar_width) +
        scale_fill_manual(
          "",
          values = c(
            "Elsevier" = "#e9711c",
            "Springer Nature" = "#486a7e",
            "Wiley" = "#068853",
            "Other" = "#b3b3b3a0"
          ), guide = "none") +
        scale_color_manual(
          values = c(
            "Elsevier" = "#e9711c",
            "Springer Nature" = "#486a7e",
            "Wiley" = "#068853",
            "Other" = "#b3b3b3"
          ), guide = "none"
        ) + 
        scale_y_continuous(labels =  scales::number_format(big.mark = ",")) +
        ggtitle("B") 
    ),
    "Publisher" = (
      ggplot(mapping = aes(fill = publisher)) +
        geom_bar(stat = "count", position = "fill", width = bar_width) + 
        scale_y_continuous("Journals", labels = scales::percent_format()) +
        scale_fill_manual(
          "",
          values = c(
            "Elsevier" = "#e9711c",
            "Springer Nature" = "#486a7e",
            "Wiley" = "#068853",
            "Other" = "#b3b3b3"
          ), guide = "none") +
        ggtitle("A")
    )
  ),
  set_sizes = (
    upset_set_size(
      geom = geom_bar(aes(fill = publisher), width = 0.8), 
      position = "right"
    ) +
    scale_fill_manual(
      "",
      values = c(
        "Elsevier" = "#e9711c",
        "Springer Nature" = "#486a7e",
        "Wiley" = "#068853",
        "Other" = "#b3b3b3"
      )
    ) +
    scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
    guides(fill = guide_legend(reverse = TRUE)) +
    ylab("Journals") 
  ),
  guides = "over",
  matrix = (
    intersection_matrix(
      geom = geom_point(
        shape = "square",
        size = 2
      )
    )
  )
)

upset_publisher_plot & my_upset_theme 
```

The three largest publishers--Elsevier, Springer Nature and Wiley--were best represented in the exclusive intersection of all three data sources  (hoaddata, Scopus, and Web of Science).
Together, they comprised `r jn_upset_publisher_ind |> filter(publisher != "Other") |> pull(n_journals) |> sum()` hybrid journals (`r jn_upset_publisher_ind |> filter(publisher != "Other") |> pull(n_journals) |> sum() / nrow(union_jns)*100`% of the intersectional set) and dominated article coverage with `r jn_upset_publisher_ind |> filter(publisher != "Other") |> pull(articles) |> sum()` (`r jn_upset_publisher_ind |> filter(publisher != "Other") |> pull(articles) |> sum() / upset_data |> filter(Crossref == TRUE, WoS == TRUE, Scopus == TRUE) |> pull(overlap) |> sum()*100`%), as determined through shared DOIs.
When examining publication volume per journal, (\ref{fig-upset_coverage_results_publisher}C), Elsevier published, on average, the largest journals, followed by Springer Nature and Wiley.

A comparative analysis of publisher portfolios across different indexing sets demonstrates that publisher were not represented uniformly. 
Springer Nature exhibited `r jn_upset_publisher |> filter(esac_publisher == "Springer Nature", WoS == FALSE, Crossref == TRUE, Scopus == TRUE) |> distinct(issn_l) |> nrow()` hybrid journals exclusively indexed in both hoaddata and Scopus.
This set included journals from the Chinese Academy of Science, German-language medical journals, and Eastern European publications including the *Journal of Mathematical Sciences*, which also publishes English-language translations of Russian-language works. 
Additionally, this subset included titles with a more broader disciplianry focus such as *SN Computer Science* and newly launched hybrid journals like *Nature Computational Science*, which started in 2021 and was indexed in Scopus but not yet in Web of Science.
The set also captured ceased journals, providing insights into the dynamic nature of journal portfolios and business strategies.


```{r miss_portfolios}
miss_tas <- jn_upset_publisher |> 
  filter(Crossref == FALSE) |> 
  group_by(esac_publisher) |> 
  summarise(journals = n_distinct(issn_l),
            n = sum(overlap, na.rm = TRUE)) |> 
  arrange(desc(n)) 

cr_tas <- jn_upset_publisher |>
  filter(Crossref == TRUE) |> 
  pull(esac_publisher)

miss_publishers <- miss_tas |>
  filter(!esac_publisher %in% cr_tas)
```

Further examination of publisher portfolios not covered by hoaddata but present in Scopus or Web of Science identified several publishers with missing Creative Commons (CC) license information in Crossref.
In particular, `r miss_tas$esac_publisher[1]` represented `r miss_tas$journals[1]` journals with `r miss_tas$n[1]` articles, `r miss_tas$esac_publisher[2]` accounted for `r miss_tas$journals[2]` journals with `r miss_tas$n[2]` articles, and `r miss_tas$esac_publisher[3]` recorded `r miss_tas$journals[3]` journals and `r miss_tas$n[3]` articles.
In total, `r nrow(miss_publishers)` publishers were not represented in Crossref.

An inspection of individual journals uncovered discrepancies in Unpaywall's open access identification for certain publishers that typically deposit CC licenses with Crossref.
Notably, some subscription-only journals contained one or two articles erroneously tagged as hybrid open access by Unpaywall, which were subsequently reflected in Scopus and Web of Science. Examples of such misclassifications include Elsevier's *Journal of Bioscience and Bioengineering* and Springer Nature's *Journal of Mechanical Science and Technology*. 

## Open Access Indicator Comparision

This section examines the uptake of open access in hybrid journals, focusing on the influence of transformative agreements across hoaddata, Scopus, and Web of Science.
The analysis assesses whether consistent results can be derived from these data sources despite differences in coverage and methodologies. 
Following @Jahn_2025, indicators were calculated for each data source and comprise the number and proportion of open access articles, including those enabled by transformative agreements, from 2019 to 2023.
For Web of Science and Scopus, the impact of transformative agreements was estimated using both first and corresponding authorships, while hoaddata indicator calculation was limited to first-author affiliations.


```{r, plot_uptake_overview, fig.asp=.5}
#| fig-cap: "Open Access indicato"
#| label: fig-uptake_overview
#| 
uptake_df <- readr::read_csv(here::here("data", "uptake_df.csv"))

# Data prep
uptake_by_year <- uptake_df |>
  group_by(earliest_year, src) |>
  summarize(
    n_articles = sum(n),
    n_oa_articles = sum(oa_articles),
    ta_oa_first_author_articles = sum(ta_oa_first_author_articles),
    ta_oa_corresponding_author_articles = sum(ta_oa_corresponding_author_articles)
  )

uptake_by_year_short <- uptake_by_year |>
  mutate(oa_prop = n_oa_articles / n_articles,
         ta_oa_prop = ta_oa_first_author_articles / n_oa_articles,
         ta_oa_cor_prop = ta_oa_corresponding_author_articles / n_oa_articles)

uptake_by_year_df <- uptake_by_year |>
  mutate(earliest_year = gsub("^20", "'", as.character(earliest_year))) |>
  pivot_longer(cols = c(ta_oa_first_author_articles, ta_oa_corresponding_author_articles))

plot_oa_all <- ggplot(uptake_by_year_df, aes(x = earliest_year)) +
  geom_line(aes(y = n_oa_articles / n_articles, group = src, color = src), linetype = "solid") +
  geom_point(aes(y = n_oa_articles / n_articles, fill = src), alpha = 0.5, shape = 21) +
  scale_fill_manual(NULL,
    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
    guide = "none"
  ) +
  scale_color_manual(NULL,
   values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  labs(y = "Hybrid OA Uptake", x = NULL)

plot_ta_oa <- ggplot(filter(uptake_by_year_df, value > 0), aes(x = earliest_year)) +
  geom_line(aes(
    y = value,
    group = interaction(src, name),
    color = src, # Color by src only
    linetype = name
  )) + # Use linetype for name
  geom_point(aes(y = value, fill = src), alpha = 0.8, shape = 21) +
  scale_color_manual(NULL, values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")) +
  scale_fill_manual(NULL,
                    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
                    guide = "none") +
  scale_linetype_manual(NULL,
    values = c(
      `ta_oa_first_author_articles` = "longdash",
      `ta_oa_corresponding_author_articles` = "dotted"
    ),
    labels = c(
      `ta_oa_first_author_articles` = "First",
      `ta_oa_corresponding_author_articles` = "Corresponding"
    )
  ) +
  scale_y_continuous(
    labels = function(x) format(x, big.mark = ",", scientific = FALSE),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  labs(y = "Hybrid OA via Agreement", x = "Publication Year")

plot_ta_perc <- ggplot(filter(uptake_by_year_df, value > 0), aes(x = earliest_year)) +
  geom_line(aes(
    y = value / n_oa_articles,
    group = interaction(src, name),
    color = src, # Color by src only
    linetype = name
  )) + # Use linetype for name
  geom_point(aes(y = value / n_oa_articles, fill = src), alpha = 0.8, shape = 21) +
  scale_color_manual(NULL, values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")) +
  scale_fill_manual(NULL,
                    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
                    guide = "none") +  
  scale_linetype_manual(NULL,
    values = c(
      `ta_oa_first_author_articles` = "longdash",
      `ta_oa_corresponding_author_articles` = "dotted"
    ),
    labels = c(
      `ta_oa_first_author_articles` = "First",
      `ta_oa_corresponding_author_articles` = "Corresponding"
    )
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  labs(y = "% of Hybrid OA via Agreement", x = NULL)

layout <- "ABC
EEE"

combined_plot <- wrap_plots(
  E = guide_area(),
  A = plot_oa_all,
  B = plot_ta_oa,
  C = plot_ta_perc,
  heights = c(1, 0),
  design = layout
) &
  theme_minimal() +
    theme(
      legend.position = "bottom",
      panel.border = element_rect(color = "grey50", fill = NA),
      text = element_text(size = 10)
    ) &
  plot_annotation(tag_levels = "A")

combined_plot + plot_layout(guides = "collect")
```

### Overview

Figure \ref{fig-uptake_overview}A shows a moderate growth of open access in hybrid journals, which is consistent across hoaddata (black line), Scopus (orange line), and Web of Science (blue line).
According to hoaddata, hybrid open access uptake increased from `r uptake_by_year_short |> filter(src == "HOAD", earliest_year == 2019) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "HOAD", earliest_year == 2019) |> pull(n_oa_articles)`) in 2019 to `r uptake_by_year_short |> filter(src == "HOAD", earliest_year == 2023) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "HOAD", earliest_year == 2023) |> pull(n_oa_articles)`) in 2023.
Similarly, Scopus recorded an growth from `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2019) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2019) |> pull(n_oa_articles)`) in 2019 to `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(n_oa_articles)`) in 2023.
However, Web of Science recorded higher open access uptake in early years, before converging in 2023, from `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2019) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2019) |> pull(n_oa_articles)`) in 2019 to `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(n_oa_articles)`) in 2023.
This may reflect delayed open access being labeled as hybrid in Web of Science.

Open access by transformative agreements increased between 2019 and 2023 (Figures \ref{fig-uptake_overview}B and C).
Trends were consistent for first (dashed line) and corresponding author (dotted line) affiliations. 
According to Scopus, `r uptake_by_year_short |> filter(src == "Scopus") |> pull(ta_oa_first_author_articles) |> sum()` open access articles could be attributed to transformative agreements based on first author metadata (increasing from `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2019) |> pull(ta_oa_first_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(ta_oa_first_author_articles) |> sum()`) and `r uptake_by_year_short |> filter(src == "Scopus") |> pull(ta_oa_corresponding_author_articles) |> sum()` using corresponding author metadata (from `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2019) |> pull(ta_oa_corresponding_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(ta_oa_corresponding_author_articles) |> sum()`).
Web of Science recorded `r uptake_by_year_short |> filter(src == "Web of Science") |> pull(ta_oa_first_author_articles) |> sum()` open access articles via transformative agreements using first author metadata (increasing from `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2019) |> pull(ta_oa_first_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(ta_oa_first_author_articles) |> sum()`)  and  `r uptake_by_year_short |> filter(src == "Web of Science") |> pull(ta_oa_corresponding_author_articles) |> sum()` using corresponding author metadata (from `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2019) |> pull(ta_oa_corresponding_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(ta_oa_corresponding_author_articles) |> sum()`).
hoaddata, lacking corresponding author data, linked `r uptake_by_year_short |> filter(src == "HOAD") |> pull(ta_oa_first_author_articles) |> sum()` articles to transformative agreements but showed slower growth than Scopus and Web of Science, from `r uptake_by_year_short |> filter(src == "HOAD", earliest_year == 2019) |> pull(ta_oa_first_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "HOAD", earliest_year == 2023) |> pull(ta_oa_first_author_articles) |> sum()`.

From 2021 (hoadata, Scopus) resp. 2022 (Web of Science),  transformative agreements enabled the majority of hybrid open access.
For first authors, the share ranged between `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(ta_oa_prop) * 100` % (Web of Science),  `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(ta_oa_prop) * 100`% (Scopus), and  `r uptake_by_year_short |> filter(src == "HOAD", earliest_year == 2023) |> pull(ta_oa_prop) * 100`% (hoaddata) in 2023.
For corresponding authors, the shares were slightly larger, with Web of Science recording `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(ta_oa_cor_prop) * 100` % and Scopus  `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(ta_oa_cor_prop) * 100`% in 2023.
However, substantial hybrid open access was still facilitated outside transformative agreements, likely through APCs payed from discretionary research funds (ref).

### Open access by publishers

```{r uptake_publisher} 
uptake_publisher <- uptake_df |>
  inner_join(esac, by = "issn_l") |>
  filter(earliest_year != "2018")

uptake_publisher_by_year <- uptake_publisher |>
  group_by(earliest_year, src, publisher) |>
  summarize(
    n_articles = sum(n),
    n_oa_articles = sum(oa_articles),
    ta_oa_first_author_articles = sum(ta_oa_first_author_articles),
    ta_oa_corresponding_author_articles = sum(ta_oa_corresponding_author_articles)
  )

uptake_by_publisher_short <- uptake_publisher_by_year |>
  mutate(oa_prop = n_oa_articles / n_articles,
         ta_oa_prop = ta_oa_first_author_articles / n_oa_articles,
         ta_oa_cor_prop = ta_oa_corresponding_author_articles / n_oa_articles)


uptake_by_year_publisher_df <- uptake_publisher_by_year |>
  mutate(earliest_year = gsub("^20", "'", as.character(earliest_year))) |>
  pivot_longer(cols = c(ta_oa_first_author_articles, ta_oa_corresponding_author_articles))
```


```{r plot_publisher_uptake_overview, fig.asp=1.1}
#| fig-cap: "Open Access indicato"
#| label: fig-uptake_publisher
#| 
publisher_plot_oa_all <- ggplot(uptake_by_year_publisher_df, aes(x = earliest_year)) +
  geom_line(aes(y = n_oa_articles / n_articles, group = src, color = src), linetype = "solid") +
  geom_point(aes(y = n_oa_articles / n_articles, fill = src), alpha = 0.5, shape = 21) +
  scale_fill_manual(NULL,
    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
    guide = "none"
  ) +
  scale_color_manual(NULL,
    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  facet_grid(~fct_rev(publisher)) +
  labs(y = "Hybrid OA Uptake", x = NULL)

publisher_plot_ta_oa <- ggplot(filter(uptake_by_year_publisher_df, value > 0), aes(x = earliest_year)) +
  geom_line(aes(
    y = value,
    group = interaction(src, name),
    color = src, # Color by src only
    linetype = name
  )) + # Use linetype for name
  geom_point(aes(y = value, fill = src), alpha = 0.8, shape = 21) +
  scale_color_manual(NULL, values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")) +
  scale_fill_manual(NULL,
                    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
                    guide = "none") +
  scale_linetype_manual(NULL,
    values = c(
      `ta_oa_first_author_articles` = "longdash",
      `ta_oa_corresponding_author_articles` = "dotted"
    ),
    labels = c(
      `ta_oa_first_author_articles` = "First",
      `ta_oa_corresponding_author_articles` = "Corresponding"
    )
  ) +
  scale_y_continuous(
    labels = function(x) format(x, big.mark = ",", scientific = FALSE),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  facet_grid(~fct_rev(publisher)) +
  labs(y = "Hybrid OA via Agreement", x = NULL)

publisher_plot_ta_perc <- ggplot(filter(uptake_by_year_publisher_df, value > 0), aes(x = earliest_year)) +
  geom_line(aes(
    y = value / n_oa_articles,
    group = interaction(src, name),
    color = src, # Color by src only
    linetype = name
  )) + # Use linetype for name
  geom_point(aes(y = value / n_oa_articles, fill = src), alpha = 0.8, shape = 21) +
  scale_color_manual(NULL, values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")) +
  scale_fill_manual(NULL,
                    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
                    guide = "none") +  
  scale_linetype_manual(NULL,
    values = c(
      `ta_oa_first_author_articles` = "longdash",
      `ta_oa_corresponding_author_articles` = "dotted"
    ),
    labels = c(
      `ta_oa_first_author_articles` = "First",
      `ta_oa_corresponding_author_articles` = "Corresponding"
    )
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  facet_grid(~fct_rev(publisher)) +
  labs(y = "% of Hybrid OA via Agreement",  x = "Publication Year")

layout <- "A
B
C
E"

publisher_combined_plot <- wrap_plots(
  E = guide_area(),
  A = publisher_plot_oa_all,
  B = publisher_plot_ta_oa,
  C = publisher_plot_ta_perc,
  heights = c(1, 1, 1, 0),
  design = layout
) &
  theme_minimal() +
    theme(
      legend.position = "bottom",
      panel.border = element_rect(color = "grey50", fill = NA),
      text = element_text(size = 10)
    ) &
  plot_annotation(tag_levels = "A")

publisher_combined_plot + plot_layout(guides = "collect")

```

When considering open access trends by publisher (see \ref{fig-uptake_publisher}), the observed differences in early uptake rates between hoaddata and Scopus compared to Web of Science can be largely attributed to articles published in Elsevier hybrid journals, the largest publisher in our sample. 
Both hoadata and Scopus reported an steady increase in open access uptake between 2019 and 2023 (hoaddata from `r uptake_by_publisher_short |> filter(src == "HOAD", publisher == "Elsevier", earliest_year == 2019) |> pull(oa_prop)*100`% to `r uptake_by_publisher_short |> filter(src == "HOAD", publisher == "Elsevier", earliest_year == 2023) |> pull(oa_prop)*100`%; Scopus from `r uptake_by_publisher_short |> filter(src == "Scopus", publisher == "Elsevier", earliest_year == 2019) |> pull(oa_prop)*100`% to `r uptake_by_publisher_short |> filter(src == "Scopus", publisher == "Elsevier", earliest_year == 2023) |> pull(oa_prop)*100`%).
In contrast, Elsevier's share remained relatively constant, increasing only slightly from `r uptake_by_publisher_short |> filter(src == "Web of Science", publisher == "Elsevier", earliest_year == 2019) |> pull(oa_prop)*100`% to `r uptake_by_publisher_short |> filter(src == "Web of Science", publisher == "Elsevier", earliest_year == 2023) |> pull(oa_prop)*100`% according to the Web of Science.
Upon inspection, this discrepancy primarily stemmed from articles provided under Elsevier's user license, used for the publisher's open archive. 
These articles, made freely available after an embargo period, were tagged as hybrid open access in Web of Science, even though its documentation specified that only articles under a CC license variant were considered. 
Previous research [@Jahn_2021; @Haustein_APC_2024] has shown that Elsevier provided a substantial portion of its articles under this license, explaining the relatively large and stable share of open access over the years.

Differences in open access evidence are also evident for Wiley. 
Specifically, Web of Science and Scopus recorded a drop in 2021 and 2022 compared to hoaddata. 
For these two years, hoaddata reported `r uptake_publisher_by_year |> filter(publisher == "Wiley", src == "HOAD", earliest_year %in% 2021:2022) |> pull(n_oa_articles) |> sum() - uptake_publisher_by_year |> filter(publisher == "Wiley", src == "Scopus", earliest_year %in% 2021:2022) |> pull(n_oa_articles) |> sum()` more open access articles than Scopus and `r uptake_publisher_by_year |> filter(publisher == "Wiley", src == "HOAD", earliest_year %in% 2021:2022) |> pull(n_oa_articles) |> sum() - uptake_publisher_by_year |> filter(publisher == "Wiley", src == "Web of Science", earliest_year %in% 2021:2022) |> pull(n_oa_articles) |> sum()` more than Web of Science. 
This discrepancy is presumably because of challenges in fetching full-texts by Unpaywall, the open access evidence source for Scopus and Web of Science.
According to Unpaywall's software version history, Wiley's publisher platform redirects prevented Unpaywall from parsing license information from full-texts.[^unpaywallwiley]
hoaddata, which relies solely on Crossref license information, was unaffected by these issues.

Despite these differences in open access evidence, the three data sources show consistent temporal trends in hybrid open access enabled by transformative agreements (see Figure \ref{fig-uptake_publisher}B and C).
Wiley emerged as the fastest-growing publisher in terms of open access uptake, with more than 30% of articles in hybrid journals reported as open access in 2023 across all data sources, followed by Springer Nature and Elsevier. 
By 2023, the share of open access enabled by transformative agreements appeared to stabilise for all three publishers, with Wiley recording the largest share (see Figure \ref{fig-uptake_publisher}B). 
Elsevier, however, showed a comparable late uptake, consistent with the publisher's historical reluctance to engage in negotations with library consortia. 
Interestingly, the differences between first and corresponding author affiliations were more pronounced at the publisher level. 
In Scopus, for example, the share of open access via transformative agreements measured by corresponding authorship was greater for Springer Nature in 2023 than when using first authorship.

### Open access by country

# discussion

[^unpaywallwiley]: See Unpaywall version history related to Wiley fixes: <https://github.com/search?q=repo%3Aourresearch%2Foadoi+wiley&type=commits>