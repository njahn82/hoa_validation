---
format:
  pdf:
    keep-tex: true
    fig_caption: yes
    template: apa6.sty
    extra_dependencies: ["flafter"]
csl: apa.csl
bibliography: references.bib
---


```{r, setup, echo=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  echo = FALSE,
  fig.width = 6,
  fig.asp = 0.618,
  out.width = "99%",
  fig.align = "center",
  dpi = 600,
  dev = c("pdf", "cairo_ps", "png"),
  fig.path = "fig/",
  fig.pos = "ht!", out.extra = ""
)
options(scipen = 999, digits = 2)
knitr::knit_hooks$set(
  inline = function(x) {
    if (is.numeric(x)) {
      return(prettyNum(x, big.mark = ","))
    } else{
      return(x)
    }
  }
)
```

```{r dependencies}
library(tidyverse, warn.conflicts = FALSE)
library(bigrquery)
library(kableExtra)
library(patchwork)
library(ComplexUpset)
library(ggrepel)

# Themes
my_upset_theme <-
  theme(panel.grid.minor = element_blank(),
        panel.grid.major.x = element_blank(),
        plot.title.position="plot",
        text = element_text(size = 10),
        plot.title = element_text(hjust = 0, vjust = 1))
```

# Introduction

Transformative agreements are a much-discussed library licensing model for transitioning subscription-based journal publishing to full open access.
Although these agreements can vary considerably, they are mainly aimed at hybrid journal bundles, allowing authors from participating institutions to publish open access in these journals while providing reading access to the entire portfolio.
Library consortia and funders have begun to coordinate how these agreements are negotiated, managed and evaluated.
At the same time, efforts are underway to improve transparency through open data on contracts and payments. 
However, this information is still only partially available, which limits large-scale studies of the impact of transformative agreements on the transition of hybrid journals to full open access.
By comparing open metadata from hoaddata, an openly available dataset on hybrid open access based on metadata from Crossref, OpenAlex and the cOAlition S Journal Checker Tool, with the established bibliometric databases Scopus and Web of Science, this study aims to provide a robust estimate of the impact of transformative agreements on hybrid open access. 
This comparative approach informs bibliometric research and practice by highlighting the strengths and weaknesses of each data source individually and collectively.

Since their initial proposal by the Max Planck Digital Library [@Schimmer_2015], transformative agreements have led to rapid growth in the number of negotiated agreements and open access articles [@Jahn_2025; @Rothfritz_2024; @McCabe_2024].
Before, only a small proportion of articles in hybrid journals were openly available [@Bj_rk_2012; @Laakso_2016; @Piwowar_2018], with publications from only a few European countries with dedicated funding policies and the high-energy physics SCOAP^3 consortium standing out [@Pinfield_2015; @Robinson_Garcia_2020; @Huang_2020; @Kohls_2018].
Related coordination activities, in particular through the OA2020 and ESAC (Efficiency and Standards for Article Charges) initiatives, have also led to improved workflows between library consortia and publishers [@ifla; @Geschuhn_2017].
However, critics have raised concerns about these agreements, particularly regarding market concentration [@Shu_2023; @Butler_2023], the failure of most hybrid journals to convert to full open access [@Momeni_2021; @Kiley_2024], reduced competition and incentives [@McCabe_2024; @Schmal_competition], and the continuation of publication fees that widen gaps between well-resourced and under-resourced institutions [@budapest; @Ross_Hellauer_2022]

While consortia evaluations confirm the growth of open access through transformative agreements and acknowledge increasing coordination, they reach mixed policy conclusions.
For instance, the British Jisc evaluation [@Jisc_2024] found that the consortium's transformative agreements had a significant impact on national open access growth but a limited effect on the global open access transition, suggesting a need to reevaluate their strategy.
Similar policy reconsiderations emerged in Norway and Sweden [@norway; @Widding_2024].
Meanwhile, the funder initiative cOAlition S recommended ending financial support for these agreements in 2024, but still considers hybrid open access to be compliant with funders' open access policies.
Conversely, the German DEAL consortium extended agreements with major publishers until 2028, while also outside of Europe, more transformative agreements are being put in place (for instance in Latin America, as described in @Mu_oz_V_lez_2024). 
Responding to criticism, the Max Planck Digital Library recently outlined strategies to evolve the original model, focusing on achieving fully open access while controlling costs and addressing identified weaknesses [@D_r_2025]

Despite controversies, transformative agreements can benefit the landscape of open research information as library consortia negotiate for comprehensive open metadata, helping avoid data analytics from becoming a commodity controlled by publishers [@Aspesi_2020; @McCabe_2024]. 
For instance, ESAC recommends using Crossref [@Hendricks_2020] to share metadata supporting workflows including open access licenses and funding information [@Geschuhn_2017]. 
Simultaneously, the bibliometric community pushes for more open metadata through this publisher-driven DOI registration platform and continuously monitors the progress [@eck_crossref_2022].

Many open scholarly data services that build on Crossref have benefited from these developments.
A prominent example is OpenAlex, which has gained attention for its inclusivity, openness and comprehensive coverage of publication metadata [@priem2022openalex].
In a recent evaluation, @C_spedes_2025 reviewed the current evidence base on the strengths and weaknesses of OpenAlex.
They highlight both its increasing use in bibliometric research and its adoption by research organisations.
Comparative studies have generally found OpenAlex to be a reliable alternative to commercial databases [@alperin2024analysissuitabilityopenalexbibliometric; @culbert2024referencecoverageanalysisopenalex], although data quality issues occurred for key metadata fields required for open access analysis, including evidence of open access status itself [@jahn2023analysing; @Simard_2024], as well as authorships [@culbert2024referencecoverageanalysisopenalex], affiliations [@Zhang_2024], author roles [@Jahn_2025] and document types used to distinguish between different article types [@Haupka_2024].
However, these studies highlight the rapid improvements and new possibilities of combining open metadata and the curation efforts of OpenAlex in conjunction with the growing awareness of the importance of open metadata, as demonstrated by the Barcelona Declaration on Open Research Information.

Consequently, there is growing interest in using open bibliometric databases such as Crossref and OpenAlex to assess the impact of transformative agreements. 
Similar to established proprietary bibliometric databases such as Scopus and Web of Science, these data sources lack specific data points, particularly about open access payments, which are typically not shared [@Haustein_APC_2024]. 
However, bibliometric data can be enriched with open metadata about journals and institutions involved in transformative agreements [@Jahn_2025]. 
@de_Jonge_2025 demonstrated this potential by combining data from the cOAlition S Journal Checker tool and OpenAlex, achieving 89% accuracy when validated against Dutch research information. 
While open data approaches show promise, understanding how these results compare when the same methodology is applied to proprietary databases such as Web of Science and Scopus remains unexplored.

This study compares open and proprietary data sources for evaluating transformative agreements. It adapts the approach from @Jahn_2025, which combines data from the cOAlition S Journal Checker tool, Crossref and OpenAlex, and applies the same methods to Web of Science and Scopus data.
This comparative approach allows the evaluation of different bibliometric data sources to monitor transformative agreements, while assessing their respective strengths and limitations.
Specifically, this study compares the indexing of more than 13,000 hybrid journals across these sources, and examines whether consistent results can be obtained in terms of open access adoption between 2019 and 2023, analysed by publishers and countries.
By comparing results across these data sources, this large-scale study provides a more robust understanding of the impact of transformative agreements on the transition to full open access. 
It also reveals the comparative strengths and weaknesses of different bibliometric databases in measuring scholarly publishing's shift toward openness.

# Data and methods

<!-- This study investigates the suitability of open scholarly data sources for assessing the impact of transformative agreements on hybrid open access. -->
As shown in Figure \ref{fig:workflow}, the methodology involved comparing hoaddata, an openly available collection of open research information on hybrid open access, with the bibliometric databases Web of Science and Scopus.
This section introduces the initial data sources, followed by a presentation of the necessary data processing steps to obtain eligible articles enabled by transformative agreements using author roles (first and corresponding) and harmonised affiliation data.
<!-- Overall, xxxx hybrid journals from xxx agreements that published at least one open access article between 2019 and 2023. formed the basis of this study. -->

<!-- Replication studies, which can be found in the Life, Natural and Social Sciences, typically employ the same or comparable methods as the original study to determine whether consistent results can be obtained (https://pmc.ncbi.nlm.nih.gov/articles/PMC10019630/). 


This study compares results drawn from the openly available and regularly updated hoaddata, an R package leveraging the open scholarly data sources Crossref and OpenAlex, with the in-house database of the German Competence Network for Bibliometrics (Kompetenznetzwerk Bibliometrie, KB), which comprises Web of Science and Scopus snapshots.
After describing the initial data sources used, the necessary pre-processing steps to obtain eligible articles from transformative agreements using author roles (first and corresponding) and affiliation data are presented.
Overall, xxxx hybrid journals from xxx agreements formed the basis of this study. This study covered journal articles published between 2019 and 2023.   -->

\begin{figure}[htbp]
\centering
\begin{tikzpicture}[node distance=2cm, thick,scale=1, every node/.style={scale=0.9}]    
% Data Sources
    \node (crossref) [datasource] {Crossref};
    \node (openAlex) [datasource, right=of crossref] {OpenAlex};
    \node (jct) [datasource, right=of openAlex] {JCT};
    \node (wos) [datasource, below=of crossref] {Web of Science};
    \node (scopus) [datasource, below=of jct] {Scopus};
    
    % Processing Steps
    \node (hoaddata) [datasource, below=1.5cm of $(crossref)!1!(openAlex)$] {hoaddata};
    \node (kb) [process, below=1cm of $(wos)!0.5!(scopus)$] {Journal and article retrieval (including open access)};
    
 % Matching Process - Fixed line break syntax
    \node (matching) [process, below=1.5cm of $(hoaddata)!1!(kb)$] {Harmonising author affiliations through ROR};

 % Aggregation
    \node (transmatch) [process, below=1.5cm of $(matching)!1!(matching)$] {Estimate article output under transformative agreements};
        
    % Output
    \node (analysis) [output, below=1.5cm of $(transmatch)!1!(transmatch)$] {Aggregated analytical datasets};
    
    % Arrows
    \draw [arrow] (crossref) -- (hoaddata);
    \draw [arrow] (openAlex) -- (hoaddata);
    \draw [arrow] (jct) -- (hoaddata);
    \draw [arrow] (hoaddata) -- (kb);
    \draw [arrow] (wos) -- (kb);
    \draw [arrow] (scopus) -- (kb);
    \draw [arrow] (kb) -- (matching);
    \draw [arrow] (matching) -- (transmatch);
    \draw [arrow] (transmatch) -- (analysis);

    
    % Legend
    \node [datasource, scale=0.7] at ($(analysis)+(4,0)$) {Data Sources};
    \node [process, scale=0.7] at ($(analysis)+(4,-1)$) {Processing Steps};
    \node [output, scale=0.7] at ($(analysis)+(4,-2)$) {Output};
\end{tikzpicture}
\caption{Data processing workflow for comparing hybrid open access uptake across bibliometric data sources. The workflow shows how data from different sources (hoaddata, derived from Crossref, OpenAlex, Transformative Agreement Data dump used by the cOAlition S Journal Checker Tool (JCT), the Web of Science, and Scopus) were processed to enable comparative analysis.}
\label{fig:workflow}
\end{figure}

## Data sources  

### hoaddata 

hoaddata, developed and maintained by the author to support open access monitoring and research (e.g. @Jahn_2025), is an R data package that regularly collects information on hybrid open access uptake from multiple openly available data sources [@hoaddata].
It combines article-level metadata from Crossref [@Hendricks_2020] and affilation metadata from OpenAlex [@priem2022openalex] with transformative agreement information from the Transformative Agreement Data dump used by the cOAlition S Journal Checker Tool (JCT)[^tadump], which links journal and institutional data about participating research organisations to agreements in the ESAC registry.

<!--While the country in which a first-author was located was used to aggregate country-level statistics, Research Organization Registry (ROR) identifiers (ROR-ID) were used in conjunction with ESAC registry information on the duration of an agreement was used to estimate whether an article was published under active transformative agreements.
This matching benefited from the availability of the ROR-IDs in both sources.
To improve the matching, JCT data were enriched to include associated institutions, such as unviersity hospitals.-->

hoaddata followed good practices for computational reproducibility using R [@Marwick_2018].
The package, which includes data, code, a test suite and documentation, is openly available on GitHub.
To ensure computational reproducibility while aggregating the data, a GitHub Actions continuous integration and delivery (CI/CD) workflow handles data retrieval from the SUB Göttingen's open scholarly data warehouse based on Google BigQuery, which provides high-performant programmatic access to monthly snapshots of Crossref and OpenAlex.[^subugoe]
The workflow has run regularly to fetch updates from these data sources since 2022.
The package version used in this study is 0.3, containing data from the Crossref 2024-08 dump provided to Crossref Metadata Plus subscribers and the OpenAlex 2024-08-29 monthly dump.
It covers agreements collected between July 2021 to July 2024 from the JCT.
This version including the computation log is available on GitHub (https://github.com/subugoe/hoaddata/releases/tag/v.0.3).

### Web of Science

Clarivate Analytics' Web of Science (WoS) is a well-established proprietary bibliometric database consisting of several collections [@Birkle_2020].
Web of Science is a selective database with a focus on base research [@Visser_2021; @Stahlschmidt_2022].
The collections considered in this study were the Science Citation Index Expanded (SCIE), Social Sciences Citation Index (SSCI) and Arts & Humanities Citation Index (AHCI).

These collections provide important data points for analysing open access: author affiliations and roles, differentiation of journal articles into document types representing different types of journal contributions, such as original articles or reviews, and open access status information derived from OurResearch's Unpaywall [@Piwowar_2018], the same provider as OpenAlex.
However, Web of Science lacks information about journals and articles under transformative agreements.

For programmatic access to article-level data, this study used the database of the Kompetenznetzwerk Bibliometrie (KB) in Germany. The KB processes raw XML data provided by Clarivate Analytics, which are ingested into an in-house PostgreSQL database under a uniform schema.
To support reproducibility, KB maintains annual snapshots of the database. 
Accordingly, this study used the annual snapshot from April 2024 (wos_b_202404), which is considered to cover almost the entire previous publication year [@schmidt_2024_13935407].

### Scopus

Elsevier's Scopus, launched in 2004, is another widely used proprietary bibliometric database for measuring research [@Baas_2020].
Similar to Web of Science, Scopus is selective with regard to the journals it indexes.
However, its journal coverage is much broader than that of the Web of Science collections considered in this study, as it indexes a wider range of applied research journals [@Singh_2021; @Visser_2021; @Stahlschmidt_2022].
With detailed metadata about article types, open access status information derived from Unpaywall, author roles, and disambiguated affiliations, Scopus also contains important data to assess open access uptake, although no direct information regarding transformative agreements was available at the time of the study.

This study used the Scopus annual snapshot from April 2024 as provided by KB (scp_b_202404). The same KB curation effort as that for Web of Science was applied to Scopus [@schmidt_2024_13935407].

## Data processing steps  

### Determining the hybrid journal publication volume

Following @Jahn_2025, the starting point was a unified dataset of several safeguarded JCT snapshots[^jct_data].
JCT journal data were enriched with ISSN variants linked to ISSN-L. 
To identify hybrid journals, a comprehensive exclusion of fully open access journals was performed using multiple journal lists including the Directory of Open Access Journals (DOAJ).
The resulting hybrid journal data were made available via hoaddata and were used to independently determine the publication volume for each database.

hoaddata relies on Crossref to obtain journal publication volume and open access status through Creative Commons (CC) licence information relative to the published version ("version of record").
<!-- Because of limited affiliation metadata in Crossref [@van_Eck_2022], hoaddata sources  affiliation metadata from OpenAlex.-->
<!-- Using an enriched and unified list of hybrid journals in transformative agreements according to the JCT, article metadata were retrieved from each database using all ISSN variants linked to an ISSN-L. -->
<!-- This study examined the adoption of open access for hybrid journals included in transformative agreements, which published at least one journal article in the five-year period 2019-2023. 
The initial data source was the Transformative Agreements Public Data from the cOAlition S Journal Checker Tool (JCT), which helps authors identify suitable open access publishing venues, as provided by hoaddata.
 Weekly snapshots of this data were archived using an automated GitHub Actions workflow (https://github.com/njahn82/jct_data) and into hoaddata.
The JCT data used in the examined hoaddata version, which was enriched with linking ISSN (ISSN-L) and ROR-IDs from associated institutions before inclusion, cover agreements active from July 2021 to July 2024. -->
<!-- The JCT journal data was enriched with the linking ISSN (ISSN-L) according to the ISSN Registry Agency.
A comprehensive exclusion of fully open access journals was performed, following the methodology described in @jahn_2025.
This involved checking multiple journal lists (DOAJ, OpenAlex, Bielefeld) and article-level investigations.
The JCT institution data was enriched with ROR-IDs from associated institutions, such as university hospitals or institutes of large research organisations such as the Max Planck Society, according to OpenAlex' institution entity.
<!-- In total, xxxx hybrid journals could be linked to xxx agreements listed in the ESAC Transformative Agreements Registry, which formed to basis for obtaining article-level data including author affiliations, open access status ans document types. -->
The article metadata included DOIs, publication dates, open access information, and author roles and affiliations.
Publication years were determined using the earliest known date of publication in a journal.
In hoaddata, this corresponded to Crossref's issued date.<!--, although variations were observed (check ref)-->
For Web of Science and Scopus, the earliest publication date was used where available, with Scopus dates specifically determined by the KB through version tracking of the raw data.

Many transformative agreements typically cover only certain types of journal
articles, in particular original research articles including reviews [@Borrego_2020].
Because of limited information on these document types in open scholarly data [@Haupka_2024], hoaddata used an extended version of Unpaywall's paratext recognition approach to exclude non-scholarly content [@Piwowar_2018].
To exclude conference supplements, which are  often not covered by transformative agreements, only articles published in regular issues, indicated by numerical pagination, were considered.
For Web of Science and Scopus, their established and mainly accurate document type classifications [@Maisano_2025; @Donner_2017] were used to identify original research articles and reviews, referred to as original articles throughout this study.

<!-- literature to check https://direct.mit.edu/qss/article/3/1/99/109079/The-prevalence-and-impact-of-university-->

### Identifying open access articles in hybrid journals

Articles in hybrid journals were considered open access when publishers made them freely available under a CC license on their platforms. 
While hoaddata obtained this information from Crossref license metadata, Web of Science and Scopus relied on Unpaywall as evidence source. 
Unpaywall also uses Crossref license metadata, but supplements them by parsing publisher websites directly, addressing cases where publishers do not provide machine-readable CC license information [@Piwowar_2018]. 
This additional parsing remains necessary despite transformative agreement workflows recommending the deposition of CC licenses during DOI registration [@Geschuhn_2017].
Both Web of Science[^wosoa] and Scopus[^scopusoa] defined hybrid open access consistently as content available under CC licenses on publisher platforms, distinguishing it from bronze open access that lack such explicit license information, or use publisher-specific licenses [@Piwowar_2018].

### Harmonising author affiliations across databases

```{r cache=TRUE}
# Article level data TA
ta_oa_inst <- readr::read_csv(here::here("data-raw", "ta_oa_inst.csv"))
```

Author affiliations were retrieved for both the first and, if available, the corresponding authors to prepare the linking between articles and institutions covered by transformative agreements.
To improve data retrieval, JCT institution data were enriched with ROR-IDs from associated institutions, such as university hospitals or institutes of large research organisations such as the Max Planck Society, according to OpenAlex's institution entity.
Database-specific affiliation identifiers were used to handle different address variants: ROR-IDs from OpenAlex for hoaddata, affiliation enhanced names for Web of Science, and Scopus Affiliation Identifier.
Additionally, ISO country codes were retrieved for each author's address to compile country-level statistics. 
<!-- These country codes for Web of Science and Scopus were provided by the KB.-->

Because neither Web of Science nor Scopus supported ROR-ID at the time of data retrieval, the institution identifier used by the JCT, a two-step matching process was implemented to harmonise the affiliation data.
First, `r length(unique(ta_oa_inst$doi))` articles from `r length(unique(ta_oa_inst$ror))` institutions with ROR-IDs in the JCT data since 2017 (according to hoaddata) were processed to map the first authors' ROR-IDs to corresponding proprietary affiliation identifiers in Web of Science and Scopus using DOI matching.
Then, an algorithm selected the most frequent ROR ID and proprietary identifier pairs to handle multiple affiliations and organisational hierarchy differences.

```{r aff_evaluation}
scp_ror <- readr::read_csv(here::here("data-raw", "scp_wos_matching.csv")) 
wos_ror <- readr::read_csv(here::here("data-raw", "ror_wos_matching.csv")) 
```

This process linked `r length(unique(scp_ror$ror))` ROR-IDs to  `r length(unique(scp_ror$vendor_org_id))` Scopus Affiliation IDs and  `r length(unique(wos_ror$ror))` ROR-IDs to `r length(unique(wos_ror$vendor_org_id))` enhanced affiliation strings in Web of Science. 
Quality evaluation through random sampling of 50 pairs revealed an error rate of 22% for Web of Science (11 mismatches) and 6% for Scopus (three mismatches). 
Upon inspection, these mismatches primarily occurred with less-represented institutions having only a few publications, introduced through multiple affiliations of single authors. 
The difference between databases suggests that Scopus' affiliation control aligns more closely with ROR than with Web of Science.

### Estimating open access in hybrid journals covered by transformative agreements

Based on these compiled matching tables, articles eligible under transformative agreements could also be obtained from Web of Science and Scopus, although they did not contain ROR-IDs used by the JCT. 
The estimation of eligible articles followed @Jahn_2025 and included matching of both journals and participating institutions according to the JCT.
The matching also considered the duration of agreements according to the ESAC registry, with only those matches where an agreement was actually in place being considered for subsequent analysis.
A related study [@de_Jonge_2025], applied to publications funded by the Dutch Research Council (NWO) and validated against internal invoicing data, confirmed that such matching can accurately identify most articles under transformative agreements.

## Data records 

As a result of the comprehensive data processing described above, datasets on open access in hybrid journals included in transformative agreements were aggregated for each database at the country and journal levels by year.
@tbl-methods_overview_tab provides a general overview of coverage between 2019 and 2023.
It shows that the majority of hybrid journals published at least one original research article or review, collectively marked as "original article" in the following, during the five-year period.
These journals have provided the basis for the subsequent calculation of article-level indicators.  

```{r methods_overview_tab}
#| label: tbl-methods_overview_tab
#| tbl-cap: "Coverage of hybrid journals in transformative agreements 2019-23."
load(here::here("data", "manuscript_data.Rda"))
methods_overview_table_df <- bind_rows(
  # Journals
  jns_ind,
  # Articles
  articles_ind,
  # OA
  oa_articles_ind,
  # Affiliation and Auhtor roles
  aff_ind
) |>
  # Human-readable indicator labels
  mutate(
    indicator = case_when(
      indicator == "ind_active_jns" ~ "Active journals",
      indicator == "ind_active_jns_core" ~ "Active journals (core)",
      indicator == "ind_active_jns_core_with_oa" ~ "Active journals (core) with OA",
      indicator == "ind_articles_total" ~ "Total published articles ",
      indicator == "ind_articles_core" ~ "Original articles",
      indicator == "ind_articles_doi" ~ "Articles with DOI",
      indicator == "ind_articles_core_doi" ~ "Original articles with DOI",
      indicator == "ind_oa_articles_all" ~ "OA articles",
      indicator == "ind_oa_articles_core" ~ "Original OA articles",
      indicator == "first_aff" ~ "First author articles",
      indicator == "cor_aff" ~ "Corresponding author articles",
    )
  )

kableExtra::kbl(
  methods_overview_table_df,
  booktabs = TRUE, 
  format.args = list(big.mark = ","), 
  digits = 1, 
  escape = TRUE, 
  position = "ht",
  col.names = c("", "hoaddata*", "Web of Science", "Scopus")
) |>
  kable_styling(position = "center") |>
  row_spec(0, bold = TRUE) |>
  pack_rows("Hybrid journal coverage", 1, 3) |>
  pack_rows("Publication volume", 4, 5) |>
  pack_rows("Digital Object Identifier (DOI) coverage", 6, 7) |>
  pack_rows("Open Access (OA) metrics", 8, 9) |>
  pack_rows("Original articles with affiliation data", 10, 11) |>
  footnote(symbol = c("Journal article metadata from Crossref, except affiliations from OpenAlex"))
```

While hoaddata only covered articles with a DOI, Scopus and Web of Science publication indicators were calculated using their database identifier.
A subsequent comparison of DOI coverage shows that non-original articles in Web of Science often lacked a DOI.
This was particularly the case for meeting abstracts, which are notably prevalent in Health Sciences journals [@Melero_Fuentes_2025] and are not indexed by Scopus [@Donner_2017].
Open access indicators were aggregated by DOI, because Unpaywall only collects information on open access status for articles with DOI.
A closer look at original articles with affiliation data, in line with related research [@Zhang_2024], reveals a lack of affiliation data in the case of OpenAlex, the affiliation data source used by hoaddata, compared to Web of Science and Scopus.
In particular, only approximately two-thirds of the articles examined provided corresponding author affiliations.
The proportion for first authors was `r methods_overview_table_df |> filter(indicator == "First author articles") |> pull(hoad) / methods_overview_table_df |> filter(indicator == "Original articles with DOI") |> pull(hoad) * 100`%.
At the time of writing, OpenAlex disclosed limited coverage of corresponding authorship data [^oacorresponding].
Therefore, only first author data for hoaddata were considered in the following analysis. 

## Data analysis

TTidyverse tools [@tidyverse] for the R programming language [@r] were used throughout this largely automated data collection and analysis process. 
Rank correlations were calculated using the Hmisc package [@Harrell_Jr_2003].
Source code analysis, including all queries used to obtain the data, is available on GitHub (<https://github.com/njahn82/hoa_validation>). 
An interactive supplement exploring correlations between the data sources examined by country and publisher is available via HuggingFace Spaces: <https://huggingface.co/spaces/najkoja/hoa_replication>.

# Results  

This section first presents the indexing of hybrid open access by comparing open data sources with the proprietary bibliometric databases Scopus and Web of Science. 
Then, using the same methods, indicators at the publisher and country levels are calculated independently for each database and compared to assess the suitability of the bibliometric databases for investigating transformative agreements.

## Coverage comparision

### Overview

```{r}
jn_upset_articles <- readr::read_csv(here::here("data", "jn_upset_articles.csv"))

all_jns <- jn_upset_articles |> 
  distinct(issn_l)

union_jns <- jn_upset_articles |>
  filter(WoS == TRUE, Crossref == TRUE, Scopus == TRUE) |>
  distinct(issn_l)

upset_data <- jn_upset_articles |> 
   mutate(overlap = case_when(Crossref == TRUE & WoS == TRUE & Scopus == TRUE ~ doi_in_wos_or_scopus,
                             Crossref == TRUE & WoS == FALSE & Scopus == TRUE ~ doi_in_scopus,
                             Crossref == TRUE & WoS == TRUE & Scopus == FALSE ~ doi_in_wos,
                             Crossref == TRUE & WoS == FALSE & Scopus == FALSE ~ n_cr,
                             Crossref == FALSE & WoS == FALSE & Scopus == TRUE ~ doi_in_scopus,
                             Crossref == FALSE & WoS == TRUE & Scopus == FALSE ~ doi_in_wos,
                             Crossref == FALSE & WoS == TRUE & Scopus == TRUE ~ doi_in_wos_or_scopus))


```

Figure \ref{fig-upset_coverage_results} presents the coverage of hybrid journals included in transformative agreements, based on the intersections of the examined data sources. 
The intersection sets of journals and articles are visualised as an UpSet graph [@Lex_2014; @ComplexUpset].
The analysis included hybrid journals that published at least one open access article between 2019 and 2023, based on open access status information from each database.
Only original articles were included in the analysis.

```{r upset_coverage_results, fig.asp=0.75}
#| fig-cap: "Comparison of hybrid journal indexing by data source, 2019-2023. Only hybrid journals present in the cOAlition S Transformative Agreement Data dump with at least one open access article are considered. A) presents the number of journals, B) the number of articles (DOI), distinguishing between shared DOI corpus and surplus in hoaddata. Box plots (C) shows the five-years journal article volume (log-scale)."
#| label: fig-upset_coverage_results
# Helper function to make text labels the same size as axis labels as seen in
# <https://wjschne.github.io/posts/making-text-labels-the-same-size-as-axis-labels-in-ggplot2/>
# Todo: Learn how to invoke it

ggtext_size <- function(base_size, ratio = 0.8) {
  ratio * base_size / ggplot2::.pt
}

bar_width <- 0.7
size <- get_size_mode("exclusive_intersection")

upset_overview <- upset_data |>
  rename(hoaddata = Crossref) |>
  ComplexUpset::upset(
  c("hoaddata", "WoS", "Scopus"),
  # Only journals in Crossref
  min_size = 30,
  set_sizes = FALSE,
  stripes = "transparent",
  # wrap = TRUE,
  name = "Data Source Coverage",
  base_annotations = list(
    "Journals" = (
      ComplexUpset::intersection_size(
        counts = FALSE,
        text = list(size = 8 / .pt),
        text_mapping = aes(
          label = paste0(!!upset_text_percentage(), '\n(', format(!!size, big.mark = ","), ')'),
          colour = ifelse(!!size > 5000, 'on_bar', 'on_background'),
          y = ifelse(!!size > 5000, !!size - 4000, !!size)
        ), width = bar_width
      ) +
        scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
        ggtitle("A")
    )
  ),
  annotations = list(
    "Journal size\n(log scale)" = (
      ggplot(mapping = aes(x = intersection, y = overlap)) +
        geom_boxplot(outliers = FALSE, width = bar_width) +
        scale_y_log10(labels =  scales::number_format(big.mark = ","), limits = c(5, 10000)) +
        ggtitle("C")
    ),
    "Articles" = (
      ggplot(mapping = aes(y = n_cr)) +
        geom_bar(
          stat = "identity",
          color = "grey80",
          width = bar_width,
          aes(fill = "Surplus")
        ) +
        geom_bar(
          aes(y = overlap, fill = "Shared"),
          stat = "identity",
          width = bar_width,
          color = "#0091c8"
        ) +
        scale_fill_manual(
          values = c(
            `Surplus` = "grey80",
            `Shared` = "#0091c8"
          ),
          name = "DOI"
        ) +
        scale_y_continuous(labels =  scales::number_format(big.mark = ","),
                           breaks = c(0, 2500000, 5000000, 7500000)) +
        guides(fill = guide_legend(reverse = TRUE)) +
        ggtitle("B")
    )
  ),
  matrix = (intersection_matrix(geom = geom_point(
    shape = "square", size = 2
  )))
)
upset_overview & my_upset_theme
```
Journal coverage analysis revealed that `r round(nrow(union_jns) / nrow(all_jns) * 100)`% (n = `r nrow(union_jns)`) of the hybrid journals included in transformative agreements were indexed in all three databases (Figure \ref{fig-upset_coverage_results}A).
The second largest set consisted of journals indexed in both hoaddata and Scopus, comprising `r round( jn_upset_articles |> filter(WoS == FALSE, Crossref == TRUE, Scopus == TRUE) |> distinct(issn_l) |> nrow() / nrow(all_jns) * 100)`% (n = `r jn_upset_articles |> filter(WoS == FALSE, Crossref == TRUE, Scopus == TRUE) |>  nrow()`) of hybrid journals.
Notably, `r round(jn_upset_articles |> filter(WoS == FALSE, Crossref == TRUE, Scopus == FALSE) |> distinct(issn_l) |> nrow() / nrow(all_jns) * 100)`% (n = `r jn_upset_articles |> filter(WoS == FALSE, Crossref == TRUE, Scopus == FALSE) |>  nrow()`) of journals were exclusively contained in hoaddata, while another `r round( jn_upset_articles |> filter(Crossref == FALSE, Scopus == TRUE) |> distinct(issn_l) |> nrow() / nrow(all_jns) * 100)`% (n = `r jn_upset_articles |> filter(Crossref == FALSE, Scopus == TRUE) |>  nrow()`) were found only in Scopus. 
Of these, `r jn_upset_articles |> filter(WoS == TRUE, Crossref == FALSE, Scopus == TRUE) |>  nrow()` were available in Web of Science.
Upon inspection, this group of hybrid journals exclusively covered in proprietary data sources mainly represented hybrid journals for which no open access evidence could be retrieved from Crossref, the open access evidence source for hoaddata.

In terms of article coverage, Figure \ref{fig-upset_coverage_results}B shows the total publication volume per combination in terms of DOI availability.
The largest set of hybrid journals covering all three data sources also represented the largest number of articles. 
In total, these journals recorded `r upset_data |> filter(Crossref == TRUE, WoS == TRUE, Scopus == TRUE) |> pull(overlap) |> sum()` articles, represented by the blue bars. They recorded `r round(upset_data |> filter(Crossref == TRUE, WoS == TRUE, Scopus == TRUE) |> pull(overlap) |> sum() / methods_overview_table_df |> filter(indicator == "Original articles with DOI") |> pull(wos) * 100)`% of the original articles with a DOI indexed in the Web of Science sample, and `r round(upset_data |> filter(Crossref == TRUE, WoS == TRUE, Scopus == TRUE) |> pull(overlap) |> sum() / methods_overview_table_df |> filter(indicator == "Original articles with DOI") |> pull(scp) * 100)`% in Scopus.
Another `r upset_data |> filter(Crossref == TRUE, WoS == FALSE, Scopus == TRUE) |> pull(n_cr) |> sum()` articles were exclusive to the intersection between Scopus and hoaddata. Exclusively in hoaddata were `r upset_data |> filter(Crossref == TRUE, WoS == FALSE, Scopus == FALSE) |> pull(n_cr) |> sum()` articles, and exclusively in the proprietary databases were `r upset_data |> filter(Crossref == FALSE, Scopus == TRUE) |> pull(overlap) |> sum(na.rm = TRUE)` articles. 

```{r miss_dois_check}
miss_dois <- readr::read_csv(here::here("data-raw", "missing_dois_in_active_jns.csv"))
miss_dois_val <- readr::read_csv(here::here("data-raw", "miss_dois_in_active_jns_ckeck.csv"))
```

Figure \ref{fig-upset_coverage_results}B also shows the surplus of articles with DOI that were only available via hoaddata (grey area).
In the case of hybrid journals covered by all three data sources, `r miss_dois |> nrow()` DOIs were present only in hoaddata.
After validation at the DOI level using KB databases and manual inspection, the main reason for missing DOI coverage in the proprietary database was insufficient classification of journal content as original articles during the compilation of hoaddata. 
Particularly, letters and editorials could not be detected fully.
Moreover, paratext recognition failed for `r round(miss_dois_val |> filter(is.na(scp_item_type), is.na(wos_item_type)) |> pull(n_doi) / miss_dois |> nrow() * 100)`% of DOIs to identify non-scholarly content, such as front matters or reviewer lists, which are generally not indexed by Scopus and Web of Science. 
To a lesser extent, differences in publication and indexing dates were reasons for non-overlapping DOIs. 

Using overlapping DOIs, the publication volume between 2019 and 2023 was calculated for each journal. 
Figure \ref{fig-upset_coverage_results}C illustrates the distribution for each combination. It shows a large spread of journal size across journals mutually covered by all three data sources. 
These journals published more on average than journals covered by only one or two data sources, with the exception of journals exclusively covered by Scopus and Web of Science. 
In particular, journals covered exclusively by hoaddata were substantially smaller. 
Upon inspection, these were often newly launched hybrid journals, which explains the relatively low five-year publication volume.
An example is *Digital society* that published `r jn_upset_articles |> filter(issn_l == "2731-4650") |> pull(n_cr)` articles.
This hybrid journal was launched in 2022, and had since been covered by various Springer Nature transformative agreements.

### Coverage by publisher portfolio

```{r publisher_coverage_data_prep}
# Add ESAC portfolio names
esac <- hoaddata::jct_hybrid_jns |>
  distinct(issn_l, esac_publisher) |>
  mutate(
    publisher = case_when(
      esac_publisher == "Elsevier" ~ "Elsevier",
      esac_publisher == "Springer Nature" ~ "Springer Nature",
      esac_publisher == "Wiley" ~ "Wiley",
      is.character(esac_publisher) ~ "Other"
    )) |>
  mutate(publisher =
           forcats::fct_relevel(
             publisher,
             c("Elsevier", "Springer Nature", "Wiley", "Other") 
           )) |>
  mutate(publisher = forcats::fct_rev(publisher)) |>
  distinct(issn_l, publisher, esac_publisher)

jn_upset_publisher <- inner_join(upset_data, esac, by = "issn_l") |>
  # Because of Journal transfer, restrict choice to one portfolio
  distinct(issn_l, .keep_all = TRUE)

jn_upset_publisher_ind <- 
  jn_upset_publisher |>
  filter(Crossref == TRUE, Scopus == TRUE, WoS == TRUE) |> 
  group_by(publisher) |>
  summarise(n_journals = n_distinct(issn_l), articles = sum(overlap, na.rm = TRUE))

jn_upset_publisher_all <- 
  jn_upset_publisher |>
  group_by(publisher) |>
  summarise(n_journals = n_distinct(issn_l), articles = sum(overlap, na.rm = TRUE))

jn_upset_publisher_all <- jn_upset_publisher |>
  summarise(n_journals_all = n_distinct(issn_l), articles_all = sum(overlap, na.rm = TRUE)) |>
  bind_cols(jn_upset_publisher_all) |>
  mutate(prop_jn = n_journals / n_journals_all,
         prop_art = articles / articles_all)
```

Figure \ref{fig-upset_coverage_results_publisher} presents the coverage of hybrid journals in transformative agreements across data sources from 2019 to 2023 focusing on publisher portfolios.
The analysis highlights the dominance of the three largest publishers, Elsevier, Springer Nature, and Wiley, which collectively accounted for `r 100 - jn_upset_publisher_all |> filter(publisher == "Other") |> pull(prop_jn)*100`% of the hybrid journals and `r 100 - jn_upset_publisher_all |> filter(publisher == "Other") |> pull(prop_art)*100`% of the articles published during this five-year period.
In terms of article volume, Elsevier led with `r jn_upset_publisher_all |> filter(publisher == "Elsevier") |> pull(articles)` articles (`r jn_upset_publisher_all |> filter(publisher == "Elsevier") |> pull(prop_art)*100`% of the total) published across `r jn_upset_publisher_all |> filter(publisher == "Elsevier") |> pull(n_journals)` hybrid journals (`r jn_upset_publisher_all |> filter(publisher == "Elsevier") |> pull(prop_jn)*100`% of the total). 
Springer Nature followed with `r jn_upset_publisher_all |> filter(publisher == "Springer Nature") |> pull(articles)` articles (`r jn_upset_publisher_all |> filter(publisher == "Springer Nature") |> pull(prop_art)*100`%) in `r jn_upset_publisher_all |> filter(publisher == "Springer Nature") |> pull(n_journals)` hybrid journals, although it recorded the largest number of hybrid journals (`r jn_upset_publisher_all |> filter(publisher == "Springer Nature") |> pull(prop_jn)*100`%). 
Wiley accounted for `r jn_upset_publisher_all |> filter(publisher == "Wiley") |> pull(articles)` articles (`r jn_upset_publisher_all |> filter(publisher == "Wiley") |> pull(prop_art)*100`%) in `r jn_upset_publisher_all |> filter(publisher == "Wiley") |> pull(n_journals)` hybrid journals (`r jn_upset_publisher_all |> filter(publisher == "Wiley") |> pull(prop_jn)*100`%).
The remaining `r jn_upset_publisher |> filter(publisher == "Other") |> distinct(esac_publisher) |> nrow()` publishers collectively accounted for `r jn_upset_publisher_all |> filter(publisher == "Other") |> pull(articles)` articles (`r jn_upset_publisher_all |> filter(publisher == "Other") |> pull(prop_art)*100`%) in `r jn_upset_publisher_all |> filter(publisher == "Other") |> pull(n_journals)` hybrid journals (`r jn_upset_publisher_all |> filter(publisher == "Other") |> pull(prop_jn)*100`%).


```{r upset_publisher_plot, fig.asp=0.75}
#| fig-cap: "Comparison of hybrid journal indexing by data source and publisher, 2019-2023. Only hybrid journals present in the cOAlition S Transformative Agreement Data dump with at least one open access article are considered. A) presents the percentage of journals by publisher, B) the number of articles by publisher (shared DOI). Box plots (C) shows the five-years journal article volume (log-scale) by publisher."
#| label: fig-upset_coverage_results_publisher
#| 
size = get_size_mode('exclusive_intersection')

upset_publisher_plot <- jn_upset_publisher |>
  rename(hoaddata = Crossref) |>
  ComplexUpset::upset(
    c("hoaddata", "WoS", "Scopus"),
  # Only journals in Crossref
  min_size = 30,
  width_ratio = 0.4,
  stripes = "transparent",
  name = "Data Source Coverage",
  base_annotations = NULL,
  annotations = list(
    "Journal size\n(log-scale)" = (
      ggplot(mapping = aes(x = intersection, y = overlap, fill = fct_rev(publisher))) +
        geom_boxplot(outliers = FALSE, width = bar_width) +
        scale_fill_manual(
          "",
          values = c(
            "Elsevier" = "#e9711c",
            "Springer Nature" = "#486a7e",
            "Wiley" = "#068853",
            "Other" = "#b3b3b3"
          ), guide = "none") +
          scale_y_log10(labels =  scales::number_format(big.mark = ",")) +
        ggtitle("C")
    ),
    "Articles" = (
      ggplot(mapping = aes(y = overlap, fill = publisher, color = publisher)) +
        geom_bar(stat = "identity", width = bar_width) +
        scale_fill_manual(
          "",
          values = c(
            "Elsevier" = "#e9711c",
            "Springer Nature" = "#486a7e",
            "Wiley" = "#068853",
            "Other" = "#b3b3b3a0"
          ), guide = "none") +
        scale_color_manual(
          values = c(
            "Elsevier" = "#e9711c",
            "Springer Nature" = "#486a7e",
            "Wiley" = "#068853",
            "Other" = "#b3b3b3"
          ), guide = "none"
        ) + 
        scale_y_continuous(labels =  scales::number_format(big.mark = ",")) +
        ggtitle("B") 
    ),
    "Publisher" = (
      ggplot(mapping = aes(fill = publisher)) +
        geom_bar(stat = "count", position = "fill", width = bar_width) + 
        scale_y_continuous("Journals", labels = scales::percent_format()) +
        scale_fill_manual(
          "",
          values = c(
            "Elsevier" = "#e9711c",
            "Springer Nature" = "#486a7e",
            "Wiley" = "#068853",
            "Other" = "#b3b3b3"
          ), guide = "none") +
        ggtitle("A")
    )
  ),
  set_sizes = (
    upset_set_size(
      geom = geom_bar(aes(fill = publisher), width = 0.8), 
      position = "right"
    ) +
    scale_fill_manual(
      "",
      values = c(
        "Elsevier" = "#e9711c",
        "Springer Nature" = "#486a7e",
        "Wiley" = "#068853",
        "Other" = "#b3b3b3"
      )
    ) +
    scale_y_continuous(labels = scales::number_format(big.mark = ",")) +
    guides(fill = guide_legend(reverse = TRUE)) +
    ylab("Journals") 
  ),
  guides = "over",
  matrix = (
    intersection_matrix(
      geom = geom_point(
        shape = "square",
        size = 2
      )
    )
  )
)

upset_publisher_plot & my_upset_theme 
```

The three largest publishers, Elsevier, Springer Nature, and Wiley, were best represented at the  intersection of all three data sources  (hoaddata, Scopus, and Web of Science).
Together, they comprised `r jn_upset_publisher_ind |> filter(publisher != "Other") |> pull(n_journals) |> sum()` hybrid journals (`r jn_upset_publisher_ind |> filter(publisher != "Other") |> pull(n_journals) |> sum() / nrow(union_jns)*100`% of the intersectional set) and dominated article coverage (n = `r jn_upset_publisher_ind |> filter(publisher != "Other") |> pull(articles) |> sum()`; `r jn_upset_publisher_ind |> filter(publisher != "Other") |> pull(articles) |> sum() / upset_data |> filter(Crossref == TRUE, WoS == TRUE, Scopus == TRUE) |> pull(overlap) |> sum()*100`%) as determined through shared DOIs.
When examining the publication volume per journal (Figure \ref{fig-upset_coverage_results_publisher}C), Elsevier published, on average, the largest journals, followed by Springer Nature and Wiley.

A comparison of publisher portfolios across different indexing sets demonstrates that publishers were not represented uniformly. 
Notably, Springer Nature exhibited `r jn_upset_publisher |> filter(esac_publisher == "Springer Nature", WoS == FALSE, Crossref == TRUE, Scopus == TRUE) |> distinct(issn_l) |> nrow()` hybrid journals exclusively indexed in both hoaddata and Scopus.
This set included journals from the Chinese Academy of Science, German-language medical journals, and Eastern European publications including the *Journal of Mathematical Sciences*, which also publishes English-language translations of Russian-language works. 
Additionally, this subset included titles with a broader disciplinary focus, such as *SN Computer Science*, and newly launched hybrid journals such as *Nature Computational Science*, which started in 2021 and were indexed in Scopus but not yet in Web of Science.
The set also captures discontinued journals, providing further insights into the dynamics of journal publishing.


```{r miss_portfolios}
miss_tas <- jn_upset_publisher |> 
  filter(Crossref == FALSE) |> 
  group_by(esac_publisher) |> 
  summarise(journals = n_distinct(issn_l),
            n = sum(overlap, na.rm = TRUE)) |> 
  arrange(desc(n)) 

cr_tas <- jn_upset_publisher |>
  filter(Crossref == TRUE) |> 
  pull(esac_publisher)

miss_publishers <- miss_tas |>
  filter(!esac_publisher %in% cr_tas)
```

Examining publisher portfolios not covered by hoaddata, but present in Scopus or Web of Science, identified several publishers with missing Creative Commons (CC) license information in Crossref.
In particular, `r miss_tas$esac_publisher[1]` represented `r miss_tas$journals[1]` journals with `r miss_tas$n[1]` articles, `r miss_tas$esac_publisher[2]` accounted for `r miss_tas$journals[2]` journals with `r miss_tas$n[2]` articles, and `r miss_tas$esac_publisher[3]` recorded `r miss_tas$journals[3]` journals with `r miss_tas$n[3]` articles.
In total, `r nrow(miss_publishers)` publishers did not share CC licenses with Crossref and were therefore not represented in hoaddata.

An inspection of individual journals also uncovered discrepancies in Unpaywall's open access identification for certain publishers that typically share CC license metadata with Crossref.
Notably, some subscription-only journals contained one or two articles erroneously tagged as hybrid open access by Unpaywall, which was subsequently reflected in Scopus and Web of Science. Examples of such misclassifications include Elsevier's *Journal of Bioscience and Bioengineering*, and Springer Nature's *Journal of Mechanical Science and Technology*. 

## Open Access Indicator Comparison

This section examines the uptake of open access in hybrid journals, focusing on the influence of transformative agreements across hoaddata, Scopus, and Web of Science.
The aim was to assess whether consistent results could be derived from these data sources despite differences in coverage and methodologies. 
Following @Jahn_2025, indicators were calculated for each data source and comprised the number and proportion of open access articles, including those enabled by transformative agreements, from 2019 to 2023.
For Web of Science and Scopus, the impact of transformative agreements was estimated using both first and corresponding authorships, while hoaddata indicator calculations were limited to first author affiliations.


```{r, plot_uptake_overview, fig.asp=.5}
#| fig-cap: "Development of open access in hybrid journals in transformative agreements by data source and author role, 2019-2023. Figure shows the open access percentage (A), the number (B) and the percentage (C) of open access articles enabled by transformative agreements."
#| label: fig-uptake_overview
#| 
uptake_df <- readr::read_csv(here::here("data", "uptake_df.csv"))

# Data prep
uptake_by_year <- uptake_df |>
  group_by(earliest_year, src) |>
  summarize(
    n_articles = sum(n),
    n_oa_articles = sum(oa_articles),
    ta_oa_first_author_articles = sum(ta_oa_first_author_articles),
    ta_oa_corresponding_author_articles = sum(ta_oa_corresponding_author_articles)
  ) |>
  mutate(src = ifelse(src == "HOAD", "hoaddata", src))

uptake_by_year_short <- uptake_by_year |>
  mutate(oa_prop = n_oa_articles / n_articles,
         ta_oa_prop = ta_oa_first_author_articles / n_oa_articles,
         ta_oa_cor_prop = ta_oa_corresponding_author_articles / n_oa_articles)

uptake_by_year_df <- uptake_by_year |>
  mutate(earliest_year = gsub("^20", "'", as.character(earliest_year))) |>
  pivot_longer(cols = c(ta_oa_first_author_articles, ta_oa_corresponding_author_articles))

plot_oa_all <- ggplot(uptake_by_year_df, aes(x = earliest_year)) +
  geom_line(aes(y = n_oa_articles / n_articles, group = src, color = src), linetype = "solid") +
  geom_point(aes(y = n_oa_articles / n_articles, fill = src), alpha = 0.5, shape = 21) +
  scale_fill_manual(NULL,
    values = c(`hoaddata` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
    guide = "none"
  ) +
  scale_color_manual(NULL,
   values = c(`hoaddata` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  labs(y = "Hybrid OA Uptake", x = NULL)

plot_ta_oa <- ggplot(filter(uptake_by_year_df, value > 0), aes(x = earliest_year)) +
  geom_line(aes(
    y = value,
    group = interaction(src, name),
    color = src, # Color by src only
    linetype = name
  )) + # Use linetype for name
  geom_point(aes(y = value, fill = src), alpha = 0.8, shape = 21) +
  scale_color_manual(NULL, values = c(`hoaddata` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")) +
  scale_fill_manual(NULL,
                    values = c(`hoaddata` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
                    guide = "none") +
  scale_linetype_manual(NULL,
    values = c(
      `ta_oa_first_author_articles` = "longdash",
      `ta_oa_corresponding_author_articles` = "dotted"
    ),
    labels = c(
      `ta_oa_first_author_articles` = "First",
      `ta_oa_corresponding_author_articles` = "Corresponding"
    )
  ) +
  scale_y_continuous(
    labels = function(x) format(x, big.mark = ",", scientific = FALSE),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  labs(y = "Hybrid OA via Agreement", x = "Publication Year")

plot_ta_perc <- ggplot(filter(uptake_by_year_df, value > 0), aes(x = earliest_year)) +
  geom_line(aes(
    y = value / n_oa_articles,
    group = interaction(src, name),
    color = src, # Color by src only
    linetype = name
  )) + # Use linetype for name
  geom_point(aes(y = value / n_oa_articles, fill = src), alpha = 0.8, shape = 21) +
  scale_color_manual(NULL, values = c(`hoaddata` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")) +
  scale_fill_manual(NULL,
                    values = c(`hoaddata` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
                    guide = "none") +  
  scale_linetype_manual(NULL,
    values = c(
      `ta_oa_first_author_articles` = "longdash",
      `ta_oa_corresponding_author_articles` = "dotted"
    ),
    labels = c(
      `ta_oa_first_author_articles` = "First",
      `ta_oa_corresponding_author_articles` = "Corresponding"
    )
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  labs(y = "% of Hybrid OA via Agreement", x = NULL)

layout <- "ABC
EEE"

combined_plot <- wrap_plots(
  E = guide_area(),
  A = plot_oa_all,
  B = plot_ta_oa,
  C = plot_ta_perc,
  heights = c(1, 0),
  design = layout
) &
  theme_minimal() +
    theme(
      legend.position = "bottom",
      panel.border = element_rect(color = "grey50", fill = NA),
      text = element_text(size = 10)
    ) &
  plot_annotation(tag_levels = "A")

combined_plot + plot_layout(guides = "collect")
```

### Overview

Figure \ref{fig-uptake_overview}A shows a moderate growth of open access in hybrid journals, which is consistent across hoaddata (black line), Scopus (yellow line), and Web of Science (blue line).
According to hoaddata, hybrid open access uptake increased from `r uptake_by_year_short |> filter(src == "hoaddata", earliest_year == 2019) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "hoaddata", earliest_year == 2019) |> pull(n_oa_articles)`) in 2019 to `r uptake_by_year_short |> filter(src == "hoaddata", earliest_year == 2023) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "hoaddata", earliest_year == 2023) |> pull(n_oa_articles)`) in 2023.
Similarly, Scopus recorded a growth from `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2019) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2019) |> pull(n_oa_articles)`) in 2019 to `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(n_oa_articles)`) in 2023.
However, Web of Science recorded higher open access uptake in the early years, before converging to a similar level in 2023, from `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2019) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2019) |> pull(n_oa_articles)`) in 2019 to `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(oa_prop)*100`% (n = `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(n_oa_articles)`) in 2023. 
This suggests a different approach towards labelling hybrid open access by Web of Science.

Similarly, hybrid open access by transformative agreements substantially increased between 2019 and 2023 (Figures \ref{fig-uptake_overview}B and C).
Trends were consistent when measuring the first (dashed line) and corresponding authorship (dotted line). 
According to Scopus, `r uptake_by_year_short |> filter(src == "Scopus") |> pull(ta_oa_first_author_articles) |> sum()` open access articles could be attributed to transformative agreements based on first author metadata (increasing from `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2019) |> pull(ta_oa_first_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(ta_oa_first_author_articles) |> sum()`) and `r uptake_by_year_short |> filter(src == "Scopus") |> pull(ta_oa_corresponding_author_articles) |> sum()` using corresponding author metadata (from `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2019) |> pull(ta_oa_corresponding_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(ta_oa_corresponding_author_articles) |> sum()`).
Web of Science recorded `r uptake_by_year_short |> filter(src == "Web of Science") |> pull(ta_oa_first_author_articles) |> sum()` open access articles via transformative agreements using first author metadata (increasing from `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2019) |> pull(ta_oa_first_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(ta_oa_first_author_articles) |> sum()`)  and  `r uptake_by_year_short |> filter(src == "Web of Science") |> pull(ta_oa_corresponding_author_articles) |> sum()` using corresponding author metadata (from `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2019) |> pull(ta_oa_corresponding_author_articles) |> sum()` to `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(ta_oa_corresponding_author_articles) |> sum()`).
hoaddata, lacking corresponding author data, linked `r uptake_by_year_short |> filter(src == "hoaddata") |> pull(ta_oa_first_author_articles) |> sum()` articles to transformative agreements, increasing from `r uptake_by_year_short |> filter(src == "hoaddata", earliest_year == 2019) |> pull(ta_oa_first_author_articles) |> sum()` in 2019 to `r uptake_by_year_short |> filter(src == "hoaddata", earliest_year == 2023) |> pull(ta_oa_first_author_articles) |> sum()` in 2023.

Since 2021 (hoadata, Scopus) resp. 2022 (Web of Science),  transformative agreements have enabled the majority of open access articles in hybrid journals.
For the first authors, the share ranged between `r uptake_by_year_short |> filter(src == "hoaddata", earliest_year == 2023) |> pull(ta_oa_prop) * 100`% (hoaddata),  `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(ta_oa_prop) * 100`% (Scopus), and   `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(ta_oa_prop) * 100` % (Web of Science) by 2023.
For the corresponding authors, the shares were slightly larger, with Scopus recording  `r uptake_by_year_short |> filter(src == "Scopus", earliest_year == 2023) |> pull(ta_oa_cor_prop) * 100`% and Web of Science `r uptake_by_year_short |> filter(src == "Web of Science", earliest_year == 2023) |> pull(ta_oa_cor_prop) * 100`% by 2023.
However, substantial hybrid open access was still facilitated outside transformative agreements, likely through APCs paid from discretionary research funds [@Suber_2012].

### Open access by publishers

```{r uptake_publisher} 
uptake_publisher <- uptake_df |>
  inner_join(esac, by = "issn_l") |>
  filter(earliest_year != "2018")

uptake_publisher_by_year <- uptake_publisher |>
  group_by(earliest_year, src, publisher) |>
  summarize(
    n_articles = sum(n),
    n_oa_articles = sum(oa_articles),
    ta_oa_first_author_articles = sum(ta_oa_first_author_articles),
    ta_oa_corresponding_author_articles = sum(ta_oa_corresponding_author_articles)
  )

uptake_by_publisher_short <- uptake_publisher_by_year |>
  mutate(oa_prop = n_oa_articles / n_articles,
         ta_oa_prop = ta_oa_first_author_articles / n_oa_articles,
         ta_oa_cor_prop = ta_oa_corresponding_author_articles / n_oa_articles)


uptake_by_year_publisher_df <- uptake_publisher_by_year |>
  mutate(earliest_year = gsub("^20", "'", as.character(earliest_year))) |>
  pivot_longer(cols = c(ta_oa_first_author_articles, ta_oa_corresponding_author_articles))
```


```{r plot_publisher_uptake_overview, fig.asp=1.1}
#| fig-cap: "Development of open access in hybrid journals included in transformative agreements by data source, author role and publisher, 2019-2023. Figure shows the open access percentage (A), the number (B) and the percentage (C) of open access articles enabled by transformative agreements."
#| label: fig-uptake_publisher
#| 
publisher_plot_oa_all <- ggplot(uptake_by_year_publisher_df, aes(x = earliest_year)) +
  geom_line(aes(y = n_oa_articles / n_articles, group = src, color = src), linetype = "solid") +
  geom_point(aes(y = n_oa_articles / n_articles, fill = src), alpha = 0.5, shape = 21) +
  scale_fill_manual(NULL,
    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
    guide = "none"
  ) +
  scale_color_manual(NULL,
    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  facet_grid(~fct_rev(publisher)) +
  labs(y = "Hybrid OA Uptake", x = NULL)

publisher_plot_ta_oa <- ggplot(filter(uptake_by_year_publisher_df, value > 0), aes(x = earliest_year)) +
  geom_line(aes(
    y = value,
    group = interaction(src, name),
    color = src, # Color by src only
    linetype = name
  )) + # Use linetype for name
  geom_point(aes(y = value, fill = src), alpha = 0.8, shape = 21) +
  scale_color_manual(NULL, values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")) +
  scale_fill_manual(NULL,
                    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
                    guide = "none") +
  scale_linetype_manual(NULL,
    values = c(
      `ta_oa_first_author_articles` = "longdash",
      `ta_oa_corresponding_author_articles` = "dotted"
    ),
    labels = c(
      `ta_oa_first_author_articles` = "First",
      `ta_oa_corresponding_author_articles` = "Corresponding"
    )
  ) +
  scale_y_continuous(
    labels = function(x) format(x, big.mark = ",", scientific = FALSE),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  facet_grid(~fct_rev(publisher)) +
  labs(y = "Hybrid OA via Agreement", x = NULL)

publisher_plot_ta_perc <- ggplot(filter(uptake_by_year_publisher_df, value > 0), aes(x = earliest_year)) +
  geom_line(aes(
    y = value / n_oa_articles,
    group = interaction(src, name),
    color = src, # Color by src only
    linetype = name
  )) + # Use linetype for name
  geom_point(aes(y = value / n_oa_articles, fill = src), alpha = 0.8, shape = 21) +
  scale_color_manual(NULL, values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9")) +
  scale_fill_manual(NULL,
                    values = c(`HOAD` = "#000000", `Scopus` = "#E69F00", `Web of Science` = "#56B4E9"),
                    guide = "none") +  
  scale_linetype_manual(NULL,
    values = c(
      `ta_oa_first_author_articles` = "longdash",
      `ta_oa_corresponding_author_articles` = "dotted"
    ),
    labels = c(
      `ta_oa_first_author_articles` = "First",
      `ta_oa_corresponding_author_articles` = "Corresponding"
    )
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  facet_grid(~fct_rev(publisher)) +
  labs(y = "% of Hybrid OA via Agreement",  x = "Publication Year")

layout <- "A
B
C
E"

publisher_combined_plot <- wrap_plots(
  E = guide_area(),
  A = publisher_plot_oa_all,
  B = publisher_plot_ta_oa,
  C = publisher_plot_ta_perc,
  heights = c(1, 1, 1, 0),
  design = layout
) &
  theme_minimal() +
    theme(
      legend.position = "bottom",
      panel.border = element_rect(color = "grey50", fill = NA),
      text = element_text(size = 10)
    ) &
  plot_annotation(tag_levels = "A")

publisher_combined_plot + plot_layout(guides = "collect")

```

When considering open access trends by publisher (see Figure \ref{fig-uptake_publisher}), the observed differences in early uptake rates between hoaddata and Scopus compared to Web of Science can be largely attributed to articles published in Elsevier hybrid journals, the largest publisher in our sample. 
Both hoadata and Scopus reported a steady increase in open access uptake between 2019 and 2023 (hoaddata from `r uptake_by_publisher_short |> filter(src == "HOAD", publisher == "Elsevier", earliest_year == 2019) |> pull(oa_prop)*100`% to `r uptake_by_publisher_short |> filter(src == "HOAD", publisher == "Elsevier", earliest_year == 2023) |> pull(oa_prop)*100`%; Scopus from `r uptake_by_publisher_short |> filter(src == "Scopus", publisher == "Elsevier", earliest_year == 2019) |> pull(oa_prop)*100`% to `r uptake_by_publisher_short |> filter(src == "Scopus", publisher == "Elsevier", earliest_year == 2023) |> pull(oa_prop)*100`%).
In contrast, Elsevier's share remained relatively constant, increasing only slightly from `r uptake_by_publisher_short |> filter(src == "Web of Science", publisher == "Elsevier", earliest_year == 2019) |> pull(oa_prop)*100`% to `r uptake_by_publisher_short |> filter(src == "Web of Science", publisher == "Elsevier", earliest_year == 2023) |> pull(oa_prop)*100`% according to Web of Science.
Upon inspection, this discrepancy was primarily due to articles under the publisher's open archive. 
These articles, made freely available after an embargo period under Elsevier's user license, were tagged as hybrid open access in Web of Science, even though its documentation[^wosoa] specified that only articles under a CC license variant were considered. 
Previous research [@Jahn_2021; @Haustein_APC_2024] has shown that Elsevier provided a substantial portion of its articles under this license, explaining the relatively large and stable share of open access over the years.

Differences in open access evidence are also evident for Wiley. 
Specifically, Web of Science and Scopus recorded a drop in 2021 and 2022 compared to hoaddata. 
For these two years, hoaddata reported `r uptake_publisher_by_year |> filter(publisher == "Wiley", src == "HOAD", earliest_year %in% 2021:2022) |> pull(n_oa_articles) |> sum() - uptake_publisher_by_year |> filter(publisher == "Wiley", src == "Scopus", earliest_year %in% 2021:2022) |> pull(n_oa_articles) |> sum()` more open access articles than Scopus and `r uptake_publisher_by_year |> filter(publisher == "Wiley", src == "HOAD", earliest_year %in% 2021:2022) |> pull(n_oa_articles) |> sum() - uptake_publisher_by_year |> filter(publisher == "Wiley", src == "Web of Science", earliest_year %in% 2021:2022) |> pull(n_oa_articles) |> sum()` more open access articles than Web of Science. 
This discrepancy is presumably due to challenges in fetching full-texts by Unpaywall, the open access evidence source for Scopus and Web of Science.
According to Unpaywall's software version history, HTTP redirects from Wiley's publisher platform, preventing Unpaywall from parsing license information from full-texts.[^unpaywallwiley]
hoaddata, which relies solely on Crossref metadata for open access identification, was unaffected by these issues.

Despite these differences in open access evidence, the three data sources show consistent temporal trends in hybrid open access enabled by transformative agreements (see Figure \ref{fig-uptake_publisher}B and C).
Wiley emerged as the fastest-growing publisher in terms of open access uptake, with more than 30% of articles in hybrid journals reported as open access in 2023 across the examined data sources, followed by Springer Nature. 
Elsevier recorded a later uptake, consistent with the publisher's historical reluctance to engage in negotiations with library consortia [@Fraser_2023].
However, by 2023, the share of open access enabled by transformative agreements appeared to stabilise for all three publishers (see Figure \ref{fig-uptake_publisher}C). 
Interestingly, the differences between first and corresponding authorships were more pronounced at the publisher level. 
In Scopus, for example, the share of open access via transformative agreements measured by the corresponding authorship was higher for Springer Nature in 2023 than when using the first authorship.

### Open access by country

When comparing countries, consistent patterns were observed across data sources for the five-year period from 2019 to 2023. 
Figure \ref{fig-uptake_country} presents hybrid open access indicators by country, comparing hoaddata (x-axis) with Web of Science and Scopus (y-axis).
Indicators calculated from these proprietary databases are shown for both the first and corresponding authors, with full counting used to account for multiple country affiliations [@Hottenrott_2021].

```{r country_data_prep}
jn_df <- readr::read_csv(here::here("data", "jn_country_stats_all.csv")) |>
  filter(issn_l != "0027-8424")
oecd <- readr::read_csv("https://raw.githubusercontent.com/njahn82/hoa_ta_effects/refs/heads/main/data/oecd.csv")

country_df <- jn_df |>
  select(-earliest_year) |>
  group_by(country_code) |>
  summarise(across(where(is.numeric), ~ sum(.x, na.rm = TRUE))) |>
  mutate(country_group = case_when(
    country_code %in% oecd$iso3 ~ "OECD",
    country_code %in% c("BRA", "RUS", "IND", "CHN", "ZAF") ~ "BRICS",
    .default = "Other"
  ))

country_article_plot_df <- country_df |>
  select(country_code, country_group, hoad_articles, scp_first_author_articles, scp_corresponding_author_articles, wos_first_author_articles, wos_corresponding_author_articles) |>
  pivot_longer(c(scp_first_author_articles, scp_corresponding_author_articles, wos_first_author_articles, wos_corresponding_author_articles)) |>
  mutate(scr = sub("_.*", "", name)) |>
  mutate(indicator = sub("^[^_]*_", "", name)) |>
  mutate(scr = case_when(
    scr == "scp" ~ "Scopus",
    scr == "wos" ~ "Web of Science"
  )) |>
  mutate(indicator = case_when(
    indicator == "first_author_articles" ~ "First",
    indicator == "corresponding_author_articles" ~ "Corresponding"
  ))

# Countries I want to highlight
country_focus <- c("USA", "CHN", "IND", "DEU", "GBR", "NLD", "SWE", "FRA", "HKG", "ZAF", "HUN", "FIN", "AUT", "NOR", "IRL")

articles_plot <- country_article_plot_df |>
  filter(!is.na(country_code), hoad_articles > 10000) |>
  ggplot(aes(x = hoad_articles, y = value, fill = country_group)) +
  geom_point(pch = 21, size = 2.5) +
  ggrepel::geom_text_repel(data = filter(country_article_plot_df, country_code %in% country_focus),
    aes(label = country_code), size = 2, min.segment.length = 0,
                force = 50) +
  scale_fill_manual(NULL, values = c("OECD" = "#91bfdb", "BRICS" = "#fc8d59", "Other" = "#ffffbf")) +
  facet_grid(vars(indicator), vars(scr)) +
  geom_abline() +
  coord_fixed(ratio = 1) +
  scale_x_log10(guide = "axis_logticks", labels = scales::number_format(big.mark = ",")) +
  scale_y_log10(guide = "axis_logticks", labels = scales::number_format(big.mark = ",")) +
  theme_minimal(base_size = 10) +
  labs(x = "Article volume (log-scale)\nhoaddata", y = "Article volume (log-scale)") +
  theme(
    axis.ticks.x = element_line(size = 0.2),
    axis.ticks.y = element_line(size = 0.2),
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)
  ) +
  theme(
    legend.position = "top",
    aspect.ratio = 1,
    panel.border = element_rect(color = "grey50", fill = NA),
    axis.title = element_text(size = 10)
  )

## OA Uptake
oa_prop_plot_df <- country_df |>
  filter(!is.na(country_code), hoad_articles > 10000) |>
  mutate(
    hoad_oa_prop = hoad_oa_articles / hoad_articles,
    scp_first_oa_prop = scp_oa_first_author_articles / scp_first_author_articles,
    scp_corresponding_oa_prop = scp_oa_corresponding_author_articles / scp_corresponding_author_articles,
    wos_first_oa_prop = wos_oa_first_author_articles / wos_first_author_articles,
    wos_corresponding_oa_prop = wos_oa_corresponding_author_articles / wos_corresponding_author_articles
  ) |>
  select(country_code, country_group, contains("prop")) |>
  pivot_longer(c(scp_first_oa_prop, scp_corresponding_oa_prop, wos_first_oa_prop, wos_corresponding_oa_prop)) |>
  mutate(scr = sub("_.*", "", name)) |>
  mutate(indicator = sub("^[^_]*_", "", name)) |>
  mutate(scr = case_when(
    scr == "scp" ~ "Scopus",
    scr == "wos" ~ "Web of Science"
  )) |>
  mutate(indicator = case_when(
    indicator == "first_oa_prop" ~ "First",
    indicator == "corresponding_oa_prop" ~ "Corresponding"
  ))

oa_prop_plot <- ggplot(oa_prop_plot_df, aes(x = hoad_oa_prop, y = value, fill = country_group)) +
  geom_point(alpha = 1, pch = 21, size = 2.5) +
ggrepel::geom_text_repel(data = filter(oa_prop_plot_df, country_code %in% country_focus),
    aes(label = country_code), size = 2, min.segment.length = 0,
                force = 50) +  scale_fill_manual(NULL, values = c("OECD" = "#91bfdb", "BRICS" = "#fc8d59", "Other" = "#ffffbf"), guide = "none") +
  facet_grid(vars(indicator), vars(scr)) +
  geom_abline() +
  coord_fixed(ratio = 1) +
  scale_x_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  theme_minimal(base_size = 10) +
  labs(x = "Hybrid OA Uptake\nhoadata", y = "Hybrid OA Uptake") +
    theme(
    axis.ticks.x = element_line(size = 0.2),
    axis.ticks.y = element_line(size = 0.2),
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)
  ) +
  theme(
 #   strip.text.x = element_blank(),
    legend.position = "top",
    aspect.ratio = 1,
    panel.border = element_rect(color = "grey50", fill = NA),
    axis.title = element_text(size = 10)
  )

## Hybrid OA via agreement
ta_oa_country_df <- country_df |>
  filter(!is.na(country_code), hoad_articles > 10000) |>
  select(country_code, country_group, hoad_ta_oa_articles, scp_ta_oa_first_author_articles, scp_ta_oa_corresponding_author_articles, wos_ta_oa_first_author_articles, wos_ta_oa_corresponding_author_articles) |>
  pivot_longer(c(scp_ta_oa_first_author_articles, scp_ta_oa_corresponding_author_articles, wos_ta_oa_first_author_articles, wos_ta_oa_corresponding_author_articles)) |>
  mutate(scr = sub("_.*", "", name)) |>
  mutate(indicator = sub("^[^_]*_", "", name)) |>
  mutate(scr = case_when(
    scr == "scp" ~ "Scopus",
    scr == "wos" ~ "Web of Science"
  )) |>
  mutate(indicator = case_when(
    indicator == "ta_oa_first_author_articles" ~ "First",
    indicator == "ta_oa_corresponding_author_articles" ~ "Corresponding"
  ))

## Hybrid OA vioa agreement share
ta_oa_country_plot <- ta_oa_country_df |>
  filter(hoad_ta_oa_articles > 1000) |>
  ggplot(aes(x = hoad_ta_oa_articles, y = value, fill = country_group)) +
  geom_point(pch = 21, size = 2.5) +
ggrepel::geom_text_repel(data = filter(ta_oa_country_df, hoad_ta_oa_articles > 1000, country_code %in% country_focus),
    aes(label = country_code), size = 2, min.segment.length = 0,
                force = 50) +  scale_fill_manual(NULL, values = c("OECD" = "#91bfdb", "BRICS" = "#fc8d59", "Other" = "#ffffbf"), guide = "none") +
  facet_grid(vars(indicator), vars(scr)) +
  geom_abline() +
  coord_fixed(ratio = 1) +
  scale_x_log10(guide = "axis_logticks", labels = scales::number_format(big.mark = ",")) +
  scale_y_log10(guide = "axis_logticks", labels = scales::number_format(big.mark = ",")) +
  theme_minimal(base_size = 10) +
  labs(x = "Hybrid OA via Agreement (log-scale)\nhoadata", y = "Hybrid OA via Agreement (log-scale)") +
  theme(
    axis.ticks.x = element_line(size = 0.2),
    axis.ticks.y = element_line(size = 0.2),
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)
  ) +
  theme(
    legend.position = "top",
    aspect.ratio = 1,
    panel.border = element_rect(color = "grey50", fill = NA),
    axis.title = element_text(size = 10)
  )

## Hybrid OA vio agreement share
ta_oa_prop_plot_df <- country_df |>
  filter(hoad_ta_oa_articles > 1000) |>
  mutate(
    hoad_oa_prop = hoad_ta_oa_articles / hoad_oa_articles,
    scp_first_oa_prop = scp_ta_oa_first_author_articles / scp_oa_first_author_articles,
    scp_corresponding_oa_prop = scp_ta_oa_corresponding_author_articles / scp_oa_corresponding_author_articles,
    wos_first_oa_prop = wos_ta_oa_first_author_articles / wos_oa_first_author_articles,
    wos_corresponding_oa_prop = wos_ta_oa_corresponding_author_articles / wos_oa_corresponding_author_articles
  ) |>
  select(country_code, country_group, contains("prop")) |>
  pivot_longer(c(scp_first_oa_prop, scp_corresponding_oa_prop, wos_first_oa_prop, wos_corresponding_oa_prop)) |>
  mutate(scr = sub("_.*", "", name)) |>
  mutate(indicator = sub("^[^_]*_", "", name)) |>
  mutate(scr = case_when(
    scr == "scp" ~ "Scopus",
    scr == "wos" ~ "Web of Science"
  )) |>
  mutate(indicator = case_when(
    indicator == "first_oa_prop" ~ "First",
    indicator == "corresponding_oa_prop" ~ "Corresponding"
  ))

ta_oa_prop_plot <- ggplot(ta_oa_prop_plot_df, aes(x = hoad_oa_prop, y = value, fill = country_group)) +
  geom_point(alpha = 1, pch = 21, size = 2.5) +
  scale_fill_manual(NULL, values = c("OECD" = "#91bfdb", "BRICS" = "#fc8d59", "Other" = "#ffffbf"), guide = "none") +
  facet_grid(vars(indicator), vars(scr)) +
  geom_abline() +
  geom_text_repel(data = filter(ta_oa_prop_plot_df, country_code %in% country_focus),
                aes(label = country_code),
                min.segment.length = 0,
                force = 50,
                size = 2) +
  coord_fixed(ratio = 1) +
  scale_x_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  scale_y_continuous(
    labels = scales::percent_format(),
    limits = c(0, NA),
    expand = expansion(mult = c(0, 0.05))
  ) +
  theme_minimal(base_size = 10) +
  labs(y = "% of Hybrid OA via Agreement", x = "% of Hybrid OA via Agreement\nhoadata") +
  theme(
    axis.ticks.x = element_line(size = 0.2),
    axis.ticks.y = element_line(size = 0.2),
    axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)
  ) +
  theme(
#    strip.text.x = element_blank(),
    legend.position = "bottom",
    aspect.ratio = 1,
    panel.border = element_rect(color = "grey50", fill = NA),
    axis.title = element_text(size = 10)
  )
```



```{r oa_country_comparision_plot_, fig.asp=1, fig.width = 8}
#| fig-cap: "Comparison of hybrid open access by country, 2019-2023. Scatterplots distinguish between proprietary databases Scopus and Web of Science, and author role. The x-axis shows hoaddata indicators. A) Five-years article volume, B) open access percentage in hybrid journals, (A and B limited to countries with > 10.000 articles published), C) number and D) percentage of open access articles enabled by transformative agreements (limited to countries with > 1.000 open access articles enabled by transformative agreements). Line represents line of equality. An interactive version is accessible via: <https://najkoja-hoa-replication.hf.space/>"
#| label: fig-uptake_country
#| 
layout <- "EE
AC
BD"

combined_oa_country_plot_ <- wrap_plots(
  E = guide_area(),
  A = articles_plot,
  B = oa_prop_plot,
  C = ta_oa_country_plot,
  D = ta_oa_prop_plot,
  design = layout,
  heights = c(0,1,1)
) &
    theme(
      legend.position = "top",
      panel.border = element_rect(color = "grey50", fill = NA),
      text = element_text(size = 12))

combined_oa_country_plot_ + plot_layout(guides = "collect") +
  plot_annotation(tag_levels = 'A')
```

In terms of article output by country (see Figure \ref{fig-uptake_country}A), strong positive correlations were observed across data sources and author roles (Spearman rank correlation $\rho > .9$, $p < 0.001$).
Between 2019 and 2023, China was the most productive country, followed by the United States and, by a certain margin, India, the United Kingdom, and Germany. 
The analysis of authorship roles revealed minimal variation, indicating that the first and corresponding authors were typically from the same country.

When examining the percentage of open access articles in hybrid journals (Figure \ref{fig-uptake_country}B), a different pattern emerged.
Authors affiliated with institutions from medium-sized European countries, such as Sweden, the Netherlands, Finland, and Hungary, made a large proportion of their articles open access.
Germany and the United Kingdom also had approximately 40% of their output available as open access.
In contrast, non-OECD countries showed notably lower adoption of hybrid open access, with South Africa being the only BRICS member well-represented in the data.
The United States also demonstrated a relatively low proportion of open access articles.
These findings were consistent across all databases.
However, France was better represented in Web of Science, likely because of its agreement with Elsevier starting in 2019, which allowed delayed open access under the publisher’s user license [@Rabesandratana_2019]. 
This licence was not classified as hybrid open access in either Scopus or hoaddata.
In all cases, Spearman rank correlations were $\rho > .9$, $p < 0.001$, indicating a high level of correlation between the databases and authorship roles considered.

Transformative agreements appeared to be a key driver of national open access growth (see Figure \ref{fig-uptake_country}C and D).
OECD members accounted for the majority of open access articles enabled by transformative agreements.
As a notable exception, South Africa again featured prominently, as the South African National Library and Information Consortium (SANLiC) successfully negotiated transformative agreements with major publishers from 2022 onward.[^sa]
The results were consistent across data sources. 
However, Wiley's open access surplus in hoaddata led to better rankings for countries where Wiley played a substantial role, such as Germany, where the DEAL consortium negotiated its first transformative agreements with publishers that started in July 2019.

<!-- A closer examination of the proportion of hybrid open access enabled by transformative agreements (see Figure \ref{fig-uptake_country}D) revealed that the French Elsevier agreement on delayed open access was not included in JCT data, as it did not qualify as a transformative agreement. -->
Medium-sized European countries again showed a high proportion of hybrid open access through transformative agreements (see Figure \ref{fig-uptake_country}D), highlighting the impact of this licensing model across all three data sources.
In contrast, the United States had a low proportion of hybrid open access enabled by agreements, suggesting that a substantial number of open access articles from US-based authors were likely financed through other means. 

In all cases, strong positive correlations were observed using Spearman's rank correlation: 
$\rho > .9$, $p < 0.001$ between data sources and authorship roles, when considering countries with a minimum of 1,000 open access articles enabled by transformative agreements between 2019 and 2023. 
When this limitation was removed, the correlation remained strong ($\rho > .85$, $p < 0.001$).
This difference may signal countries where only a few institutions had transformative agreements in place, as opposed to those participating in national consortia with broader participation.

# Discussion

This study of over 13,000 hybrid journals shows a substantial rise in open access due to transformative agreements between 2019 and 2023, although most articles remained paywalled.
While transformative agreements accounted for the majority of open access, many articles continue to become open through the payment of individual publication fees.
Hybrid open access and transformative agreements remain concentrated among a small group of large commercial publishers, 
with high-income European countries—alongside South Africa—showing high adoption rates.
In contrast, the three most productive countries, China, the United States, and India, show a substantially lower adoption in transformative agreements.
Open questions remain as to whether this uneven distribution reflects temporary implementation gaps, inherent inequities in the transformative agreement model, or deliberate avoidance of such agreements.

The findings were consistent across the investigated open data source hoaddata, derived from Crossref and OpenAlex, and the established proprietary bibliometric databases Scopus and Web of Science. 
This is consistent with previous studies [@Akbaritabar_2024; @alperin2024analysissuitabilityopenalexbibliometric] and rankings [@eck_2024_6bx73].
Overall, the results show strong correlations by country affiliation, which supports the use open metadata for large-scale analyses of hybrid open access. 
However, the observed differences in journal coverage and metadata availability warrant further discussion, affecting not only open data sources but also proprietary databases when used in isolation.

The coverage analysis revealed that hybrid journals are well indexed in all three data sources, particularly in terms of article coverage, reflecting the dominance of major publishers whose established journal portfolios are comprehensively indexed in proprietary databases [@vanbellen2024oligopolyacademicpublisherspersists].
Differences emerge for journals targeting practitioners or local non-English language communities, with many such titles indexed exclusively in Crossref and Scopus.
Using Crossref as a bibliometric database in hoaddata demonstrated a particular strength in identifying newly established hybrid journals, a notable finding given that transformative agreements primarily target existing subscription-based journals.
The landscape of hybrid journal publishing thus differs markedly from that of fully open access journals.
Comparing the coverage of OpenAlex, Scopus and Web of Science, @Simard_2024 indicate that only half of the fully open access journals listed in the DOAJ are also indexed in Scopus and Web of Science.
Notably, journals that charge no publication fees ("diamond journals") are absent from the selective Web of Science, which reinforces existing disparities in the indexing of under-represented research communities and regions in selective bibliometric databases [@Simard_2024].

<!-- A notable advantage of using Scopus and Web of Science to study the impact of transformative agreements is their comprehensive differentiation of journal articles by document type, as many agreements restrict funding to original articles and reviews [@Borrego_2023]. 
This resulted in slightly higher open access rates in Scopus and Web of Science. -->

A frequently reported limitation of studying open access with less selective databases is the lack of corresponding authorship information [@Fraser_2023; @Haucap_2021; @Shu_2023]. 
However, this analysis demonstrates that indicators based on first authors, which have often been used as a proxy for determining open access funding, and corresponding authors show a high level of correlation, reflecting disciplinary norms in scholarly publishing with regard to contributorship and author roles and positions [@Larivi_re_2016]. 
The first author typically conduct the main research underlying a paper, while the corresponding author often supervises the research [@Mattsson_2010; @Fox_2018]. 
Unsurprisingly, measures based on first or corresponding authorships are strongly correlated, suggesting that these authors share the same country affiliation. 
In most cases, the first author is identical to the corresponding author [@Chinchilla_Rodr_guez_2024].
<!-- Thus, first authorship can reliably be used in large-scale studies to assess the impact of transformative agreements. -->
Despite this correlation, the study observed a recent slight increase in open access articles by corresponding authors over first authors across Springer Nature hybrid journals.
This prompts questions about how institutional open access sponsorship practices influence author roles and assignments within co-author teams, especially as funding opportunities vary [@Gumpenberger_2018]. 
Previous research has highlighted how institutionalised bibliometric practices can affect the valuation of authorship positions [@Helgesson_2020], suggesting the need to monitor the potential influences of the availability of open access funding on authorship roles [@Maddi_2024].

Another critical data element in the study is affiliation data, which is essential for estimating open access enabled by transformative agreements. 
Although OpenAlex's affiliation coverage is less comprehensive, which likely reduced the number of articles confidently attributed to transformative agreements in this study, it still showed high correlations with Scopus and Web of Science at the country level.
However, OpenAlex's native ROR-ID integration offers a distinct advantage, allowing a more reliable identification of agreement-enabled articles compared to Scopus and Web of Science, which require reconciliation with proprietary organisation identifiers. 
Future studies based on Web of Science will benefit from the recent integration of ROR-IDs, announced by the end of 2024.
<!-- Dimension is another scholarly data source that uses open standards to identify journals, which enables analysing transformative agreements [@Fraser_2023].-->

The database comparison revealed important discrepancies in open access evidence. 
Crucially, not all publishers share CC licence metadata via Crossref, a limitation that becomes apparent when contrasting Crossref with Unpaywall’s data in Scopus and Web of Science. 
While Unpaywall can detect such gaps by parsing publishers' websites for open access licences, it nevertheless missed a substantial number of CC-licensed open access articles from Wiley journals indexed in Crossref, likely because of  parsing errors on the publisher's website. 
This resulted in fewer open access articles being recorded in Scopus and Web of Science.
Further inconsistencies emerged between Scopus and Web of Science, despite both relying on Unpaywall: Web of Science erroneously labels Elsevier’s delayed open access as hybrid, whereas Scopus correctly categorises it.
Notably, Scopus and Crossref showed greater alignment than that observed in a related comparison between Scopus and OpenAlex [@alperin2024analysissuitabilityopenalexbibliometric]. 
This likely reflects the use of a curated list to identify hybrid open access journals, rather than depending solely on article-level tags.
Given these variations, which may compromise comparability, research and monitoring exercises should avoid relying on a single source. 
Instead, the selection of open access evidence should be cross-verified using multiple sources and snapshots that can be used to track changes in the data over time [@Huang_2020]. Incorporating expert-curated journal lists can also help prevent misclassification based on business models [@Visser_2021].

It is important to note that the study's estimates of articles from institutions involved in transformative agreements are approximations because of a lack of access to invoice data, which is not usually shared by library consortia and publishers. 
Furthermore, the open data sources for transformative agreements, including the cOAlition S Journal Checker Tool and the ESAC registry, are based on voluntary effort, crowd-sourced from various consortia. 
However, recent validation using Dutch research information demonstrates the reliability of such an open approach for the assessment of articles under transformative agreements [@de_Jonge_2025]. 
With enhanced open metadata compliance attributable to evolving standards and initiatives in support of negotiations with publishers, particularly through the ESAC initiative and Barcelona Declaration on Open Research Information, the situation is likely to improve. In conclusion, this study has shown that open metadata are well-suited for analysing the transition from subscription-based journal publishing to full open access.

# Author contributions {-}

The author confirms the sole responsibility for the following: Conceptualization, Methodology, Formal analysis, Investigation, Data Curation, Writing - Original Draft, Writing - Review & Editing, Visualization.

# Competing interests {-}

The author declares no competing interests. 

# Funding information {-}

This work was supported by the Federal Ministry of Education and Research of Germany (BMBF) under grants 16WIK2301E / 16WIK2101F.

The proprietary bibliometric data from Scopus and Web of Science were provided by the German Competence Network for Bibliometrics under BMBF grant 16WIK2101A.

# Data and code availability {-}

Data source code supplement is available via GitHub: <https://github.com/njahn82/hoa_validation>. An interactive dashboard, which allows the browsing of metrics by country and publisher, is available on HuggingFace Spaces: <https://huggingface.co/spaces/najkoja/hoa_replication>.

Please note that according to the licence terms for Scopus and Web of Science, as provided by the  German Competence Network for Bibliometrics, only aggregated data accompanying the scientific publication can be made publicly available for replication purposes. 

Open metadata provided by Crossref, OpenAlex, and cOAlition S Journal Checker Transformative Agreement Data are freely available for re-use.

# References

[^unpaywallwiley]: See Unpaywall version history related to Wiley fixes: <https://github.com/search?q=repo%3Aourresearch%2Foadoi+wiley&type=commits>

[^sa]: <https://sanlic.ac.za/read-and-publish-agreements/>

[^subugoe]: <https://subugoe.github.io/scholcomm_analytics/data.html>

[^tadump]: <https://journalcheckertool.org/transformative-agreements/>

[^jct_data]: <https://github.com/njahn82/jct_data>

[^wosoa]: <https://webofscience.help.clarivate.com/en-us/Content/open-access.html>

[^scopusoa]: <https://blog.scopus.com/posts/scopus-filters-for-open-access-type-and-green-oa-full-text-access-option>

[^oacorresponding]: <https://docs.openalex.org/api-entities/works/work-object/authorship-object#is_corresponding>
